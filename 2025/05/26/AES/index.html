<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>AES算法总结 | hanafuda_store's Blog</title><meta name="author" content="hanafuda_store"><meta name="copyright" content="hanafuda_store"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="算法详解AES（Advanced Encryption Standard）是新一代的加密标准，其分组长度为128位，密钥长度常为128位。AES的SPN（Substitution-Permutation Network，代换-置换网络） 结构是其加密过程的核心设计思想。SPN 是一种对称密钥分组密码结构，通过多轮重复的 代换（Substitution） 和 置换（Permutation） 操作">
<meta property="og:type" content="article">
<meta property="og:title" content="AES算法总结">
<meta property="og:url" content="https://hanafudastore.github.io/2025/05/26/AES/index.html">
<meta property="og:site_name" content="hanafuda_store&#39;s Blog">
<meta property="og:description" content="算法详解AES（Advanced Encryption Standard）是新一代的加密标准，其分组长度为128位，密钥长度常为128位。AES的SPN（Substitution-Permutation Network，代换-置换网络） 结构是其加密过程的核心设计思想。SPN 是一种对称密钥分组密码结构，通过多轮重复的 代换（Substitution） 和 置换（Permutation） 操作">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://github.com/HanafudaStore/HanafudaStore.github.io/blob/main/img/b_52dc589762a01ba008b258bcf66823d6.jpg">
<meta property="article:published_time" content="2025-05-25T22:00:00.000Z">
<meta property="article:modified_time" content="2025-10-27T17:35:00.496Z">
<meta property="article:author" content="hanafuda_store">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/HanafudaStore/HanafudaStore.github.io/blob/main/img/b_52dc589762a01ba008b258bcf66823d6.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "AES算法总结",
  "url": "https://hanafudastore.github.io/2025/05/26/AES/",
  "image": "https://github.com/HanafudaStore/HanafudaStore.github.io/blob/main/img/b_52dc589762a01ba008b258bcf66823d6.jpg",
  "datePublished": "2025-05-25T22:00:00.000Z",
  "dateModified": "2025-10-27T17:35:00.496Z",
  "author": [
    {
      "@type": "Person",
      "name": "hanafuda_store",
      "url": "https://hanafudastore.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="https://github.com/HanafudaStore/HanafudaStore.github.io/blob/main/img/haruhi04.ico"><link rel="canonical" href="https://hanafudastore.github.io/2025/05/26/AES/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'AES算法总结',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">hanafuda_store's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">AES算法总结</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">AES算法总结</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-05-25T22:00:00.000Z" title="发表于 2025-05-26 06:00:00">2025-05-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-10-27T17:35:00.496Z" title="更新于 2025-10-28 01:35:00">2025-10-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Crypto/">Crypto</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><meta name="referrer" content="no-referrer" />

<h2 id="算法详解"><a href="#算法详解" class="headerlink" title="算法详解"></a>算法详解</h2><p>AES（Advanced Encryption Standard）是新一代的加密标准，其分组长度为128位，密钥长度常为128位。AES的SPN（Substitution-Permutation Network，代换-置换网络） 结构是其加密过程的核心设计思想。SPN 是一种对称密钥分组密码结构，通过多轮重复的 代换（Substitution） 和 置换（Permutation） 操作，结合密钥扩展机制，实现高效的混淆（Confusion）和扩散（Diffusion），从而确保安全性。</p>
<p>AES加密算法的SPN结构有四步操作：逐字节替代（SubBytes）、行移位（ShiftRows）、列混淆（MixColumns）和轮密钥加（AddRoundKey）。</p>
<ol>
<li>逐字节替代SubBytes：</li>
</ol>
<p>AES 加密中的核心非线性操作步骤，通过S盒对状态矩阵的每个字节进行替换，实现混淆。代码中，SubBytes通过查表高效实现：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// S 盒定义（部分）  </span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> S[<span class="number">256</span>] = &#123;  </span><br><span class="line">    <span class="number">0x63</span>, <span class="number">0x7C</span>, <span class="number">0x77</span>, <span class="number">0x7B</span>, <span class="number">0xF2</span>, <span class="number">0x6B</span>, <span class="number">0x6F</span>, <span class="number">0xC5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x2B</span>, <span class="number">0xFE</span>, <span class="number">0xD7</span>, <span class="number">0xAB</span>, <span class="number">0x76</span>,  </span><br><span class="line">    <span class="comment">// ... 其余 240 个字节  </span></span><br><span class="line">&#125;;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// SubBytes 函数  </span></span><br><span class="line"><span class="type">int</span> <span class="title function_">subBytes</span><span class="params">(<span class="type">uint8_t</span> (*state)[<span class="number">4</span>])</span> &#123;  </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j) &#123;  </span><br><span class="line">            state[i][j] = S[state[i][j]]; <span class="comment">// 直接查表替换  </span></span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<ol start="2">
<li>行移位ShiftRows：</li>
</ol>
<p>行移位（ShiftRows）​ 是 AES 加密中的关键步骤，属于 ​置换（Permutation）​ 操作，负责在状态矩阵的行方向上扩散字节，增强算法的 ​扩散性（Diffusion）​，使得单个字节的变化能在多轮迭代后扩散到整个密文分组。其代码实现为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">shiftRows</span><span class="params">(<span class="type">uint8_t</span> (*state)[<span class="number">4</span>])</span> &#123;  </span><br><span class="line">    <span class="type">uint32_t</span> block[<span class="number">4</span>] = &#123;<span class="number">0</span>&#125;;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 将每行 4 字节转换为 32 位整数  </span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;  </span><br><span class="line">        LOAD32H(block[i], state[i]);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 按行循环左移不同偏移量  </span></span><br><span class="line">    block[<span class="number">1</span>] = ROF32(block[<span class="number">1</span>], <span class="number">8</span>);   <span class="comment">// 行1左移1字节  </span></span><br><span class="line">    block[<span class="number">2</span>] = ROF32(block[<span class="number">2</span>], <span class="number">16</span>);  <span class="comment">// 行2左移2字节  </span></span><br><span class="line">    block[<span class="number">3</span>] = ROF32(block[<span class="number">3</span>], <span class="number">24</span>);  <span class="comment">// 行3左移3字节  </span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 将32位整数转回字节数组  </span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;  </span><br><span class="line">        STORE32H(block[i], state[i]);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<ol start="3">
<li>列混淆MixColumns：</li>
</ol>
<p>是 AES 加密中的核心线性变换步骤，属于​扩散（Diffusion）操作，负责在状态矩阵的列方向上混合字节，使得单个字节的变化扩散到整个列。其通过​矩阵乘法对每一列进行变换，代码实现为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 有限域乘法函数  </span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">GMul</span><span class="params">(<span class="type">uint8_t</span> a, <span class="type">uint8_t</span> b)</span> &#123;  </span><br><span class="line">    <span class="type">uint8_t</span> p = <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; ++i) &#123;  </span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">0x01</span>) &#123;  </span><br><span class="line">            p ^= a;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="type">int</span> hiBitSet = (a &amp; <span class="number">0x80</span>);  </span><br><span class="line">        a &lt;&lt;= <span class="number">1</span>;  </span><br><span class="line">        <span class="keyword">if</span> (hiBitSet) &#123;  </span><br><span class="line">            a ^= <span class="number">0x1B</span>; <span class="comment">// 异或不可约多项式 0x11B（去最高位）  </span></span><br><span class="line">        &#125;  </span><br><span class="line">        b &gt;&gt;= <span class="number">1</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> p;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// 列混淆（加密）  </span></span><br><span class="line"><span class="type">int</span> <span class="title function_">mixColumns</span><span class="params">(<span class="type">uint8_t</span> (*state)[<span class="number">4</span>])</span> &#123;  </span><br><span class="line">    <span class="type">uint8_t</span> tmp[<span class="number">4</span>][<span class="number">4</span>];  </span><br><span class="line">    <span class="type">uint8_t</span> M[<span class="number">4</span>][<span class="number">4</span>] = &#123;&#123;<span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x01</span>&#125;,  </span><br><span class="line">                       &#123;<span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x01</span>&#125;,  </span><br><span class="line">                       &#123;<span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>&#125;,  </span><br><span class="line">                       &#123;<span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x02</span>&#125;&#125;;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 复制原始状态到临时矩阵  </span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j) &#123;  </span><br><span class="line">            tmp[i][j] = state[i][j];  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 矩阵乘法  </span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j) &#123;  </span><br><span class="line">            state[i][j] = GMul(M[i][<span class="number">0</span>], tmp[<span class="number">0</span>][j]) ^  </span><br><span class="line">                          GMul(M[i][<span class="number">1</span>], tmp[<span class="number">1</span>][j]) ^  </span><br><span class="line">                          GMul(M[i][<span class="number">2</span>], tmp[<span class="number">2</span>][j]) ^  </span><br><span class="line">                          GMul(M[i][<span class="number">3</span>], tmp[<span class="number">3</span>][j]);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<ol start="4">
<li>轮密钥异或AddRoundKey：</li>
</ol>
<p>是 AES 加密和解密中的关键步骤，在每轮中通过 ​异或（XOR）操作 将当前状态矩阵与轮密钥（Round Key）结合，确保密钥信息融入每一轮的处理过程。它是 AES 中唯一直接使用密钥的步骤，承担了密钥混淆的核心作用。在代码中，轮密钥通常以 ​32 位字（uint32_t）​ 存储，需转换为 4×4 字节矩阵后再异或：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">addRoundKey</span><span class="params">(<span class="type">uint8_t</span> (*state)[<span class="number">4</span>], <span class="type">const</span> <span class="type">uint32_t</span> *roundKey)</span> &#123;  </span><br><span class="line">    <span class="type">uint8_t</span> keyBytes[<span class="number">4</span>][<span class="number">4</span>]; <span class="comment">// 将轮密钥从uint32_t[4]转换为4x4字节矩阵  </span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 提取轮密钥的每个字节  </span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> col = <span class="number">0</span>; col &lt; <span class="number">4</span>; col++) &#123;  </span><br><span class="line">        keyBytes[<span class="number">0</span>][col] = (<span class="type">uint8_t</span>)(roundKey[col] &gt;&gt; <span class="number">24</span>); <span class="comment">// 高位字节  </span></span><br><span class="line">        keyBytes[<span class="number">1</span>][col] = (<span class="type">uint8_t</span>)(roundKey[col] &gt;&gt; <span class="number">16</span>);  </span><br><span class="line">        keyBytes[<span class="number">2</span>][col] = (<span class="type">uint8_t</span>)(roundKey[col] &gt;&gt; <span class="number">8</span>);  </span><br><span class="line">        keyBytes[<span class="number">3</span>][col] = (<span class="type">uint8_t</span>)(roundKey[col] &amp; <span class="number">0xFF</span>); <span class="comment">// 低位字节  </span></span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 逐字节异或  </span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> row = <span class="number">0</span>; row &lt; <span class="number">4</span>; row++) &#123;  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> col = <span class="number">0</span>; col &lt; <span class="number">4</span>; col++) &#123;  </span><br><span class="line">            state[row][col] ^= keyBytes[row][col];  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>而AES的密钥生成过程则是将初始密钥（128&#x2F;192&#x2F;256位）扩展为多轮加密所需的​轮密钥（Round Keys）​ 的过程。以 AES-128（128位密钥，10轮加密）为例，密钥扩展生成11个轮密钥​（每轮使用一个）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">// 密钥扩展函数  </span><br><span class="line">void KeyExpansion(const uint8_t *key, uint32_t *w) &#123;  </span><br><span class="line">    // 加载初始密钥到w[0]-w[3]  </span><br><span class="line">    for (int i = 0; i &lt; 4; i++) &#123;  </span><br><span class="line">        w[i] = ((uint32_t)key[4*i] &lt;&lt; 24) |   </span><br><span class="line">               ((uint32_t)key[4*i+1] &lt;&lt; 16) |   </span><br><span class="line">               ((uint32_t)key[4*i+2] &lt;&lt; 8) |   </span><br><span class="line">               (uint32_t)key[4*i+3];  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    // 生成后续字（w[4]-w[43]）  </span><br><span class="line">    for (int i = 4; i &lt; 44; i++) &#123;  </span><br><span class="line">        uint32_t temp = w[i-1];  </span><br><span class="line">        if (i % 4 == 0) &#123;  </span><br><span class="line">            temp = SubWord(RotWord(temp)) ^ Rcon[i/4];  </span><br><span class="line">        &#125;  </span><br><span class="line">        w[i] = w[i-4] ^ temp;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">// 循环左移1字节  </span><br><span class="line">uint32_t RotWord(uint32_t x) &#123;  </span><br><span class="line">    return (x &lt;&lt; 8) | (x &gt;&gt; 24);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">// S盒替换  </span><br><span class="line">uint32_t SubWord(uint32_t x) &#123;  </span><br><span class="line">    return (S[(x &gt;&gt; 24) &amp; 0xFF] &lt;&lt; 24) |   </span><br><span class="line">           (S[(x &gt;&gt; 16) &amp; 0xFF] &lt;&lt; 16) |   </span><br><span class="line">           (S[(x &gt;&gt; 8) &amp; 0xFF] &lt;&lt; 8) |   </span><br><span class="line">           S[x &amp; 0xFF];  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><p>完整的C语言代码实现可表示为</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span>  </span></span><br><span class="line">  </span><br><span class="line"><span class="type">void</span> <span class="title function_">she</span><span class="params">(<span class="type">int</span> *p)</span><span class="comment">//S盒  </span></span><br><span class="line">&#123;  </span><br><span class="line">	<span class="type">int</span> i;  </span><br><span class="line">	<span class="type">int</span> s[<span class="number">256</span>] =  </span><br><span class="line">	&#123;  </span><br><span class="line">	<span class="number">0x63</span>,<span class="number">0x7c</span>,<span class="number">0x77</span>,<span class="number">0x7b</span>,<span class="number">0xf2</span>,<span class="number">0x6b</span>,<span class="number">0x6f</span>,<span class="number">0xc5</span>,<span class="number">0x30</span>,<span class="number">0x01</span>,<span class="number">0x67</span>,<span class="number">0x2b</span>,<span class="number">0xfe</span>,<span class="number">0xd7</span>,<span class="number">0xab</span>,<span class="number">0x76</span>,  </span><br><span class="line">	<span class="number">0xca</span>,<span class="number">0x82</span>,<span class="number">0xc9</span>,<span class="number">0x7d</span>,<span class="number">0xfa</span>,<span class="number">0x59</span>,<span class="number">0x47</span>,<span class="number">0xf0</span>,<span class="number">0xad</span>,<span class="number">0xd4</span>,<span class="number">0xa2</span>,<span class="number">0xaf</span>,<span class="number">0x9c</span>,<span class="number">0xa4</span>,<span class="number">0x72</span>,<span class="number">0xc0</span>,  </span><br><span class="line">	<span class="number">0xb7</span>,<span class="number">0xfd</span>,<span class="number">0x93</span>,<span class="number">0x26</span>,<span class="number">0x36</span>,<span class="number">0x3f</span>,<span class="number">0xf7</span>,<span class="number">0xcc</span>,<span class="number">0x34</span>,<span class="number">0xa5</span>,<span class="number">0xe5</span>,<span class="number">0xf1</span>,<span class="number">0x71</span>,<span class="number">0xd8</span>,<span class="number">0x31</span>,<span class="number">0x15</span>,  </span><br><span class="line">	<span class="number">0x04</span>,<span class="number">0xc7</span>,<span class="number">0x23</span>,<span class="number">0xc3</span>,<span class="number">0x18</span>,<span class="number">0x96</span>,<span class="number">0x05</span>,<span class="number">0x9a</span>,<span class="number">0x07</span>,<span class="number">0x12</span>,<span class="number">0x80</span>,<span class="number">0xe2</span>,<span class="number">0xeb</span>,<span class="number">0x27</span>,<span class="number">0xb2</span>,<span class="number">0x75</span>,  </span><br><span class="line">	<span class="number">0x09</span>,<span class="number">0x83</span>,<span class="number">0x2c</span>,<span class="number">0x1a</span>,<span class="number">0x1b</span>,<span class="number">0x6e</span>,<span class="number">0x5a</span>,<span class="number">0xa0</span>,<span class="number">0x52</span>,<span class="number">0x3b</span>,<span class="number">0xd6</span>,<span class="number">0xb3</span>,<span class="number">0x29</span>,<span class="number">0xe3</span>,<span class="number">0x2f</span>,<span class="number">0x84</span>,  </span><br><span class="line">	<span class="number">0x53</span>,<span class="number">0xd1</span>,<span class="number">0x00</span>,<span class="number">0xed</span>,<span class="number">0x20</span>,<span class="number">0xfc</span>,<span class="number">0xb1</span>,<span class="number">0x5b</span>,<span class="number">0x6a</span>,<span class="number">0xcb</span>,<span class="number">0xbe</span>,<span class="number">0x39</span>,<span class="number">0x4a</span>,<span class="number">0x4c</span>,<span class="number">0x58</span>,<span class="number">0xcf</span>,  </span><br><span class="line">	<span class="number">0xd0</span>,<span class="number">0xef</span>,<span class="number">0xaa</span>,<span class="number">0xfb</span>,<span class="number">0x43</span>,<span class="number">0x4d</span>,<span class="number">0x33</span>,<span class="number">0x85</span>,<span class="number">0x45</span>,<span class="number">0xf9</span>,<span class="number">0x02</span>,<span class="number">0x7f</span>,<span class="number">0x50</span>,<span class="number">0x3c</span>,<span class="number">0x9f</span>,<span class="number">0xa8</span>,  </span><br><span class="line">	<span class="number">0x51</span>,<span class="number">0xa3</span>,<span class="number">0x40</span>,<span class="number">0x8f</span>,<span class="number">0x92</span>,<span class="number">0x9d</span>,<span class="number">0x38</span>,<span class="number">0xf5</span>,<span class="number">0xbc</span>,<span class="number">0xb6</span>,<span class="number">0xda</span>,<span class="number">0x21</span>,<span class="number">0x10</span>,<span class="number">0xff</span>,<span class="number">0xf3</span>,<span class="number">0xd2</span>,  </span><br><span class="line">	<span class="number">0xcd</span>,<span class="number">0x0c</span>,<span class="number">0x13</span>,<span class="number">0xec</span>,<span class="number">0x5f</span>,<span class="number">0x97</span>,<span class="number">0x44</span>,<span class="number">0x17</span>,<span class="number">0xc4</span>,<span class="number">0xa7</span>,<span class="number">0x7e</span>,<span class="number">0x3d</span>,<span class="number">0x64</span>,<span class="number">0x5d</span>,<span class="number">0x19</span>,<span class="number">0x73</span>,  </span><br><span class="line">	<span class="number">0x60</span>,<span class="number">0x81</span>,<span class="number">0x4f</span>,<span class="number">0xdc</span>,<span class="number">0x22</span>,<span class="number">0x2a</span>,<span class="number">0x90</span>,<span class="number">0x88</span>,<span class="number">0x46</span>,<span class="number">0xee</span>,<span class="number">0xb8</span>,<span class="number">0x14</span>,<span class="number">0xde</span>,<span class="number">0x5e</span>,<span class="number">0x0b</span>,<span class="number">0xdb</span>,  </span><br><span class="line">	<span class="number">0xe0</span>,<span class="number">0x32</span>,<span class="number">0x3a</span>,<span class="number">0x0a</span>,<span class="number">0x49</span>,<span class="number">0x06</span>,<span class="number">0x24</span>,<span class="number">0x5c</span>,<span class="number">0xc2</span>,<span class="number">0xd3</span>,<span class="number">0xac</span>,<span class="number">0x62</span>,<span class="number">0x91</span>,<span class="number">0x95</span>,<span class="number">0xe4</span>,<span class="number">0x79</span>,  </span><br><span class="line">	<span class="number">0xe7</span>,<span class="number">0xc8</span>,<span class="number">0x37</span>,<span class="number">0x6d</span>,<span class="number">0x8d</span>,<span class="number">0xd5</span>,<span class="number">0x4e</span>,<span class="number">0xa9</span>,<span class="number">0x6c</span>,<span class="number">0x56</span>,<span class="number">0xf4</span>,<span class="number">0xea</span>,<span class="number">0x65</span>,<span class="number">0x7a</span>,<span class="number">0xae</span>,<span class="number">0x08</span>,  </span><br><span class="line">	<span class="number">0xba</span>,<span class="number">0x78</span>,<span class="number">0x25</span>,<span class="number">0x2e</span>,<span class="number">0x1c</span>,<span class="number">0xa6</span>,<span class="number">0xb4</span>,<span class="number">0xc6</span>,<span class="number">0xe8</span>,<span class="number">0xdd</span>,<span class="number">0x74</span>,<span class="number">0x1f</span>,<span class="number">0x4b</span>,<span class="number">0xbd</span>,<span class="number">0x8b</span>,<span class="number">0x8a</span>,  </span><br><span class="line">	<span class="number">0x70</span>,<span class="number">0x3e</span>,<span class="number">0xb5</span>,<span class="number">0x66</span>,<span class="number">0x48</span>,<span class="number">0x03</span>,<span class="number">0xf6</span>,<span class="number">0x0e</span>,<span class="number">0x61</span>,<span class="number">0x35</span>,<span class="number">0x57</span>,<span class="number">0xb9</span>,<span class="number">0x86</span>,<span class="number">0xc1</span>,<span class="number">0x1d</span>,<span class="number">0x9e</span>,  </span><br><span class="line">	<span class="number">0xe1</span>,<span class="number">0xf8</span>,<span class="number">0x98</span>,<span class="number">0x11</span>,<span class="number">0x69</span>,<span class="number">0xd9</span>,<span class="number">0x8e</span>,<span class="number">0x94</span>,<span class="number">0x9b</span>,<span class="number">0x1e</span>,<span class="number">0x87</span>,<span class="number">0xe9</span>,<span class="number">0xce</span>,<span class="number">0x55</span>,<span class="number">0x28</span>,<span class="number">0xdf</span>,  </span><br><span class="line">	<span class="number">0x8c</span>,<span class="number">0xa1</span>,<span class="number">0x89</span>,<span class="number">0x0d</span>,<span class="number">0xbf</span>,<span class="number">0xe6</span>,<span class="number">0x42</span>,<span class="number">0x68</span>,<span class="number">0x41</span>,<span class="number">0x99</span>,<span class="number">0x2d</span>,<span class="number">0x0f</span>,<span class="number">0xb0</span>,<span class="number">0x54</span>,<span class="number">0xbb</span>,<span class="number">0x16</span>  </span><br><span class="line">	&#125;;  </span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)*(p + i) = s[*(p + i)];  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="type">void</span> <span class="title function_">gshe</span><span class="params">(<span class="type">int</span> *p)</span><span class="comment">//g-S盒  </span></span><br><span class="line">&#123;  </span><br><span class="line">	<span class="type">int</span> i;  </span><br><span class="line">	<span class="type">int</span> s[<span class="number">256</span>] =  </span><br><span class="line">	&#123;  </span><br><span class="line">	<span class="number">0x63</span>,<span class="number">0x7c</span>,<span class="number">0x77</span>,<span class="number">0x7b</span>,<span class="number">0xf2</span>,<span class="number">0x6b</span>,<span class="number">0x6f</span>,<span class="number">0xc5</span>,<span class="number">0x30</span>,<span class="number">0x01</span>,<span class="number">0x67</span>,<span class="number">0x2b</span>,<span class="number">0xfe</span>,<span class="number">0xd7</span>,<span class="number">0xab</span>,<span class="number">0x76</span>,  </span><br><span class="line">	<span class="number">0xca</span>,<span class="number">0x82</span>,<span class="number">0xc9</span>,<span class="number">0x7d</span>,<span class="number">0xfa</span>,<span class="number">0x59</span>,<span class="number">0x47</span>,<span class="number">0xf0</span>,<span class="number">0xad</span>,<span class="number">0xd4</span>,<span class="number">0xa2</span>,<span class="number">0xaf</span>,<span class="number">0x9c</span>,<span class="number">0xa4</span>,<span class="number">0x72</span>,<span class="number">0xc0</span>,  </span><br><span class="line">	<span class="number">0xb7</span>,<span class="number">0xfd</span>,<span class="number">0x93</span>,<span class="number">0x26</span>,<span class="number">0x36</span>,<span class="number">0x3f</span>,<span class="number">0xf7</span>,<span class="number">0xcc</span>,<span class="number">0x34</span>,<span class="number">0xa5</span>,<span class="number">0xe5</span>,<span class="number">0xf1</span>,<span class="number">0x71</span>,<span class="number">0xd8</span>,<span class="number">0x31</span>,<span class="number">0x15</span>,  </span><br><span class="line">	<span class="number">0x04</span>,<span class="number">0xc7</span>,<span class="number">0x23</span>,<span class="number">0xc3</span>,<span class="number">0x18</span>,<span class="number">0x96</span>,<span class="number">0x05</span>,<span class="number">0x9a</span>,<span class="number">0x07</span>,<span class="number">0x12</span>,<span class="number">0x80</span>,<span class="number">0xe2</span>,<span class="number">0xeb</span>,<span class="number">0x27</span>,<span class="number">0xb2</span>,<span class="number">0x75</span>,  </span><br><span class="line">	<span class="number">0x09</span>,<span class="number">0x83</span>,<span class="number">0x2c</span>,<span class="number">0x1a</span>,<span class="number">0x1b</span>,<span class="number">0x6e</span>,<span class="number">0x5a</span>,<span class="number">0xa0</span>,<span class="number">0x52</span>,<span class="number">0x3b</span>,<span class="number">0xd6</span>,<span class="number">0xb3</span>,<span class="number">0x29</span>,<span class="number">0xe3</span>,<span class="number">0x2f</span>,<span class="number">0x84</span>,  </span><br><span class="line">	<span class="number">0x53</span>,<span class="number">0xd1</span>,<span class="number">0x00</span>,<span class="number">0xed</span>,<span class="number">0x20</span>,<span class="number">0xfc</span>,<span class="number">0xb1</span>,<span class="number">0x5b</span>,<span class="number">0x6a</span>,<span class="number">0xcb</span>,<span class="number">0xbe</span>,<span class="number">0x39</span>,<span class="number">0x4a</span>,<span class="number">0x4c</span>,<span class="number">0x58</span>,<span class="number">0xcf</span>,  </span><br><span class="line">	<span class="number">0xd0</span>,<span class="number">0xef</span>,<span class="number">0xaa</span>,<span class="number">0xfb</span>,<span class="number">0x43</span>,<span class="number">0x4d</span>,<span class="number">0x33</span>,<span class="number">0x85</span>,<span class="number">0x45</span>,<span class="number">0xf9</span>,<span class="number">0x02</span>,<span class="number">0x7f</span>,<span class="number">0x50</span>,<span class="number">0x3c</span>,<span class="number">0x9f</span>,<span class="number">0xa8</span>,  </span><br><span class="line">	<span class="number">0x51</span>,<span class="number">0xa3</span>,<span class="number">0x40</span>,<span class="number">0x8f</span>,<span class="number">0x92</span>,<span class="number">0x9d</span>,<span class="number">0x38</span>,<span class="number">0xf5</span>,<span class="number">0xbc</span>,<span class="number">0xb6</span>,<span class="number">0xda</span>,<span class="number">0x21</span>,<span class="number">0x10</span>,<span class="number">0xff</span>,<span class="number">0xf3</span>,<span class="number">0xd2</span>,  </span><br><span class="line">	<span class="number">0xcd</span>,<span class="number">0x0c</span>,<span class="number">0x13</span>,<span class="number">0xec</span>,<span class="number">0x5f</span>,<span class="number">0x97</span>,<span class="number">0x44</span>,<span class="number">0x17</span>,<span class="number">0xc4</span>,<span class="number">0xa7</span>,<span class="number">0x7e</span>,<span class="number">0x3d</span>,<span class="number">0x64</span>,<span class="number">0x5d</span>,<span class="number">0x19</span>,<span class="number">0x73</span>,  </span><br><span class="line">	<span class="number">0x60</span>,<span class="number">0x81</span>,<span class="number">0x4f</span>,<span class="number">0xdc</span>,<span class="number">0x22</span>,<span class="number">0x2a</span>,<span class="number">0x90</span>,<span class="number">0x88</span>,<span class="number">0x46</span>,<span class="number">0xee</span>,<span class="number">0xb8</span>,<span class="number">0x14</span>,<span class="number">0xde</span>,<span class="number">0x5e</span>,<span class="number">0x0b</span>,<span class="number">0xdb</span>,  </span><br><span class="line">	<span class="number">0xe0</span>,<span class="number">0x32</span>,<span class="number">0x3a</span>,<span class="number">0x0a</span>,<span class="number">0x49</span>,<span class="number">0x06</span>,<span class="number">0x24</span>,<span class="number">0x5c</span>,<span class="number">0xc2</span>,<span class="number">0xd3</span>,<span class="number">0xac</span>,<span class="number">0x62</span>,<span class="number">0x91</span>,<span class="number">0x95</span>,<span class="number">0xe4</span>,<span class="number">0x79</span>,  </span><br><span class="line">	<span class="number">0xe7</span>,<span class="number">0xc8</span>,<span class="number">0x37</span>,<span class="number">0x6d</span>,<span class="number">0x8d</span>,<span class="number">0xd5</span>,<span class="number">0x4e</span>,<span class="number">0xa9</span>,<span class="number">0x6c</span>,<span class="number">0x56</span>,<span class="number">0xf4</span>,<span class="number">0xea</span>,<span class="number">0x65</span>,<span class="number">0x7a</span>,<span class="number">0xae</span>,<span class="number">0x08</span>,  </span><br><span class="line">	<span class="number">0xba</span>,<span class="number">0x78</span>,<span class="number">0x25</span>,<span class="number">0x2e</span>,<span class="number">0x1c</span>,<span class="number">0xa6</span>,<span class="number">0xb4</span>,<span class="number">0xc6</span>,<span class="number">0xe8</span>,<span class="number">0xdd</span>,<span class="number">0x74</span>,<span class="number">0x1f</span>,<span class="number">0x4b</span>,<span class="number">0xbd</span>,<span class="number">0x8b</span>,<span class="number">0x8a</span>,  </span><br><span class="line">	<span class="number">0x70</span>,<span class="number">0x3e</span>,<span class="number">0xb5</span>,<span class="number">0x66</span>,<span class="number">0x48</span>,<span class="number">0x03</span>,<span class="number">0xf6</span>,<span class="number">0x0e</span>,<span class="number">0x61</span>,<span class="number">0x35</span>,<span class="number">0x57</span>,<span class="number">0xb9</span>,<span class="number">0x86</span>,<span class="number">0xc1</span>,<span class="number">0x1d</span>,<span class="number">0x9e</span>,  </span><br><span class="line">	<span class="number">0xe1</span>,<span class="number">0xf8</span>,<span class="number">0x98</span>,<span class="number">0x11</span>,<span class="number">0x69</span>,<span class="number">0xd9</span>,<span class="number">0x8e</span>,<span class="number">0x94</span>,<span class="number">0x9b</span>,<span class="number">0x1e</span>,<span class="number">0x87</span>,<span class="number">0xe9</span>,<span class="number">0xce</span>,<span class="number">0x55</span>,<span class="number">0x28</span>,<span class="number">0xdf</span>,  </span><br><span class="line">	<span class="number">0x8c</span>,<span class="number">0xa1</span>,<span class="number">0x89</span>,<span class="number">0x0d</span>,<span class="number">0xbf</span>,<span class="number">0xe6</span>,<span class="number">0x42</span>,<span class="number">0x68</span>,<span class="number">0x41</span>,<span class="number">0x99</span>,<span class="number">0x2d</span>,<span class="number">0x0f</span>,<span class="number">0xb0</span>,<span class="number">0x54</span>,<span class="number">0xbb</span>,<span class="number">0x16</span>  </span><br><span class="line">	&#125;;  </span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)*(p + i) = s[*(p + i)];  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="type">void</span> <span class="title function_">left</span><span class="params">(<span class="type">int</span> *p)</span><span class="comment">//行移位  </span></span><br><span class="line">&#123;  </span><br><span class="line">	<span class="type">int</span> i, j;  </span><br><span class="line">	<span class="type">int</span> b[<span class="number">4</span>][<span class="number">4</span>];  </span><br><span class="line">	<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)  </span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)  </span><br><span class="line">			b[j][i] = *(p + j * <span class="number">4</span> + (i + j) % <span class="number">4</span>);  </span><br><span class="line">	<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)  </span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)  </span><br><span class="line">			*(p + i + j * <span class="number">4</span>) = b[j][i];  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="type">void</span> <span class="title function_">addbyte16</span><span class="params">(<span class="type">int</span> *p, <span class="type">int</span> *q)</span><span class="comment">//4*4矩阵字节加法，结果保存到左加数，也为轮密钥加  </span></span><br><span class="line">&#123;  </span><br><span class="line">	<span class="type">int</span> i, j;  </span><br><span class="line">	<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)  </span><br><span class="line">		*(p + j * <span class="number">4</span> + i) = *(p + j * <span class="number">4</span> + i) ^ *(q + j * <span class="number">4</span> + i);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="type">void</span> <span class="title function_">addbyte4</span><span class="params">(<span class="type">int</span> *p, <span class="type">int</span> *q)</span><span class="comment">//1*4矩阵字节加法，结果保存到左加数  </span></span><br><span class="line">&#123;  </span><br><span class="line">	<span class="type">int</span> i;  </span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)  </span><br><span class="line">		*(p + i) = *(p + i) ^ *(q + i);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="type">int</span> <span class="title function_">mul</span><span class="params">(<span class="type">int</span> b,<span class="type">int</span> a)</span><span class="comment">//有限域上的乘法，只定义了01、02、03与其他数相乘  </span></span><br><span class="line">&#123;  </span><br><span class="line">	<span class="keyword">if</span> (b == <span class="number">0x02</span>)  </span><br><span class="line">	&#123;  </span><br><span class="line">		<span class="keyword">if</span> (a &lt; <span class="number">0x80</span>)a = (a * <span class="number">0x02</span>);  </span><br><span class="line">		<span class="keyword">else</span> a = ((a % <span class="number">0x80</span>) * <span class="number">0x02</span>) ^ <span class="number">0x1b</span>;  </span><br><span class="line">	&#125;  </span><br><span class="line">	<span class="keyword">if</span> (b == <span class="number">0x03</span>)  </span><br><span class="line">	&#123;  </span><br><span class="line">		<span class="keyword">if</span> (a &lt; <span class="number">0x80</span>)b = (a * <span class="number">0x02</span>);  </span><br><span class="line">		<span class="keyword">else</span> b = ((a % <span class="number">0x80</span>) * <span class="number">0x02</span>) ^ <span class="number">0x1b</span>;  </span><br><span class="line">		a = a^b;  </span><br><span class="line">	&#125;  </span><br><span class="line">	<span class="keyword">return</span> a;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="type">void</span> <span class="title function_">column</span><span class="params">(<span class="type">int</span> *p, <span class="type">int</span> *q)</span><span class="comment">//列混淆  </span></span><br><span class="line">&#123;  </span><br><span class="line">	<span class="type">int</span> i, j;  </span><br><span class="line">	<span class="type">int</span> a[<span class="number">4</span>][<span class="number">4</span>];  </span><br><span class="line">	<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)  </span><br><span class="line">	&#123;  </span><br><span class="line">		a[j][i] = mul(*(q + j * <span class="number">4</span> + <span class="number">0</span>), *(p + <span class="number">0</span> * <span class="number">4</span> + i)) ^ mul(*(q + j * <span class="number">4</span> + <span class="number">1</span>), *(p + <span class="number">1</span> * <span class="number">4</span> + i)) ^  </span><br><span class="line">			mul(*(q + j * <span class="number">4</span> + <span class="number">2</span>), *(p + <span class="number">2</span> * <span class="number">4</span> + i)) ^ mul(*(q + j * <span class="number">4</span> + <span class="number">3</span>), *(p + <span class="number">3</span> * <span class="number">4</span> + i));  </span><br><span class="line">	&#125;  </span><br><span class="line">	<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)*(p + j * <span class="number">4</span> + i) = a[j][i];  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="type">void</span> <span class="title function_">g</span><span class="params">(<span class="type">int</span> *p,<span class="type">int</span> j)</span><span class="comment">//g函数  </span></span><br><span class="line">&#123;  </span><br><span class="line">	<span class="type">int</span> rc[<span class="number">10</span>] = &#123; <span class="number">0x01</span>,<span class="number">0x02</span>,<span class="number">0x04</span>,<span class="number">0x08</span>,<span class="number">0x10</span>,<span class="number">0x20</span>,<span class="number">0x40</span>,<span class="number">0x80</span>,<span class="number">0x1b</span>,<span class="number">0x36</span> &#125;;  </span><br><span class="line">	<span class="type">int</span> i,a = *p;  </span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)*(p+i) = *(p + i + <span class="number">1</span>);*(p + <span class="number">3</span>) = a;  </span><br><span class="line">	gshe(p);  </span><br><span class="line">	*p = *p^rc[j];  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"><span class="type">void</span> <span class="title function_">keyextension</span><span class="params">(<span class="type">int</span> *p, <span class="type">int</span> j)</span><span class="comment">//密钥扩展  </span></span><br><span class="line">&#123;  </span><br><span class="line">	<span class="type">int</span> a[<span class="number">4</span>], b[<span class="number">4</span>], c[<span class="number">4</span>], d[<span class="number">4</span>], d1[<span class="number">4</span>];  </span><br><span class="line">	<span class="type">int</span> i, *q1 = &amp;a[<span class="number">0</span>], *q2 = &amp;b[<span class="number">0</span>], *q3 = &amp;c[<span class="number">0</span>], *q4 = &amp;d[<span class="number">0</span>], *q5 = &amp;d1[<span class="number">0</span>];  </span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)a[i] = *(p + i * <span class="number">4</span> + <span class="number">0</span>);  </span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)b[i] = *(p + i * <span class="number">4</span> + <span class="number">1</span>);  </span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)c[i] = *(p + i * <span class="number">4</span> + <span class="number">2</span>);  </span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)d[i] = *(p + i * <span class="number">4</span> + <span class="number">3</span>);  </span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)d1[i] = *(p + i * <span class="number">4</span> + <span class="number">3</span>);  </span><br><span class="line">	g(q5, j);  </span><br><span class="line">	addbyte4(q1, q5);  </span><br><span class="line">	addbyte4(q2, q1);  </span><br><span class="line">	addbyte4(q3, q2);  </span><br><span class="line">	addbyte4(q4, q3);  </span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)*(p + i * <span class="number">4</span> + <span class="number">0</span>) = a[i];  </span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)*(p + i * <span class="number">4</span> + <span class="number">1</span>) = b[i];  </span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)*(p + i * <span class="number">4</span> + <span class="number">2</span>) = c[i];  </span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)*(p + i * <span class="number">4</span> + <span class="number">3</span>) = d[i];  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span> &#123;  </span><br><span class="line">	<span class="type">int</span> i, j;  </span><br><span class="line">	<span class="type">int</span> u[<span class="number">4</span>][<span class="number">4</span>],key[<span class="number">4</span>][<span class="number">4</span>];  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//输入明文  </span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;input plaintext:\n&quot;</span>);  </span><br><span class="line">	<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)  </span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)  </span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%x&quot;</span>,&amp;u[j][i]);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//输入密钥  </span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;input key:\n&quot;</span>);  </span><br><span class="line">	<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)  </span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)  </span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%x&quot;</span>,&amp;key[j][i]);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//列混淆常数矩阵  </span></span><br><span class="line">	<span class="type">int</span> u1[<span class="number">4</span>][<span class="number">4</span>] =  </span><br><span class="line">	&#123;  </span><br><span class="line">		<span class="number">0x02</span>,<span class="number">0x03</span>,<span class="number">0x01</span>,<span class="number">0x01</span>,  </span><br><span class="line">		<span class="number">0x01</span>,<span class="number">0x02</span>,<span class="number">0x03</span>,<span class="number">0x01</span>,  </span><br><span class="line">		<span class="number">0x01</span>,<span class="number">0x01</span>,<span class="number">0x02</span>,<span class="number">0x03</span>,  </span><br><span class="line">		<span class="number">0x03</span>,<span class="number">0x01</span>,<span class="number">0x01</span>,<span class="number">0x02</span>  </span><br><span class="line">	&#125;;  </span><br><span class="line">	<span class="type">int</span> *p = &amp;u[<span class="number">0</span>][<span class="number">0</span>];  </span><br><span class="line">	<span class="type">int</span> *q = &amp;u1[<span class="number">0</span>][<span class="number">0</span>];  </span><br><span class="line">	<span class="type">int</span> *k = &amp;key[<span class="number">0</span>][<span class="number">0</span>];  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//第一轮前  </span></span><br><span class="line">	addbyte16(p,k);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//第一轮到第九轮（0~8）  </span></span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)  </span><br><span class="line">	&#123;  </span><br><span class="line">		she(p);  </span><br><span class="line">		left(p);  </span><br><span class="line">		column(p,q);  </span><br><span class="line">		keyextension(k,i);  </span><br><span class="line">		addbyte16(p,k);  </span><br><span class="line">	&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//第十轮  </span></span><br><span class="line">	she(p);  </span><br><span class="line">	left(p);  </span><br><span class="line">	keyextension(k,<span class="number">9</span>);  </span><br><span class="line">	addbyte16(p,k);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//密文输出  </span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;ciphertext:\n&quot;</span>);  </span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)  </span><br><span class="line">	&#123;  </span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)<span class="built_in">printf</span>(<span class="string">&quot;%x &quot;</span>, u[i][j]);  </span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);  </span><br><span class="line">	&#125;  </span><br><span class="line">  </span><br><span class="line">	system(<span class="string">&quot;pause&quot;</span>);  </span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>python代码实现可表示为：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AES</span>:  </span><br><span class="line">  </span><br><span class="line">    MIX_C  = [[<span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x1</span>, <span class="number">0x1</span>], [<span class="number">0x1</span>, <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x1</span>], [<span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x2</span>, <span class="number">0x3</span>], [<span class="number">0x3</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x2</span>]]  </span><br><span class="line">    I_MIXC = [[<span class="number">0xe</span>, <span class="number">0xb</span>, <span class="number">0xd</span>, <span class="number">0x9</span>], [<span class="number">0x9</span>, <span class="number">0xe</span>, <span class="number">0xb</span>, <span class="number">0xd</span>], [<span class="number">0xd</span>, <span class="number">0x9</span>, <span class="number">0xe</span>, <span class="number">0xb</span>], [<span class="number">0xb</span>, <span class="number">0xd</span>, <span class="number">0x9</span>, <span class="number">0xe</span>]]  </span><br><span class="line">    RCon   = [<span class="number">0x01000000</span>, <span class="number">0x02000000</span>, <span class="number">0x04000000</span>, <span class="number">0x08000000</span>, <span class="number">0x10000000</span>, <span class="number">0x20000000</span>, <span class="number">0x40000000</span>, <span class="number">0x80000000</span>, <span class="number">0x1B000000</span>, <span class="number">0x36000000</span>]  </span><br><span class="line">  </span><br><span class="line">    S_BOX = [[<span class="number">0x63</span>, <span class="number">0x7C</span>, <span class="number">0x77</span>, <span class="number">0x7B</span>, <span class="number">0xF2</span>, <span class="number">0x6B</span>, <span class="number">0x6F</span>, <span class="number">0xC5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x2B</span>, <span class="number">0xFE</span>, <span class="number">0xD7</span>, <span class="number">0xAB</span>, <span class="number">0x76</span>],  </span><br><span class="line">             [<span class="number">0xCA</span>, <span class="number">0x82</span>, <span class="number">0xC9</span>, <span class="number">0x7D</span>, <span class="number">0xFA</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xF0</span>, <span class="number">0xAD</span>, <span class="number">0xD4</span>, <span class="number">0xA2</span>, <span class="number">0xAF</span>, <span class="number">0x9C</span>, <span class="number">0xA4</span>, <span class="number">0x72</span>, <span class="number">0xC0</span>],  </span><br><span class="line">             [<span class="number">0xB7</span>, <span class="number">0xFD</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3F</span>, <span class="number">0xF7</span>, <span class="number">0xCC</span>, <span class="number">0x34</span>, <span class="number">0xA5</span>, <span class="number">0xE5</span>, <span class="number">0xF1</span>, <span class="number">0x71</span>, <span class="number">0xD8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>],  </span><br><span class="line">             [<span class="number">0x04</span>, <span class="number">0xC7</span>, <span class="number">0x23</span>, <span class="number">0xC3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9A</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xE2</span>, <span class="number">0xEB</span>, <span class="number">0x27</span>, <span class="number">0xB2</span>, <span class="number">0x75</span>],  </span><br><span class="line">             [<span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2C</span>, <span class="number">0x1A</span>, <span class="number">0x1B</span>, <span class="number">0x6E</span>, <span class="number">0x5A</span>, <span class="number">0xA0</span>, <span class="number">0x52</span>, <span class="number">0x3B</span>, <span class="number">0xD6</span>, <span class="number">0xB3</span>, <span class="number">0x29</span>, <span class="number">0xE3</span>, <span class="number">0x2F</span>, <span class="number">0x84</span>],  </span><br><span class="line">             [<span class="number">0x53</span>, <span class="number">0xD1</span>, <span class="number">0x00</span>, <span class="number">0xED</span>, <span class="number">0x20</span>, <span class="number">0xFC</span>, <span class="number">0xB1</span>, <span class="number">0x5B</span>, <span class="number">0x6A</span>, <span class="number">0xCB</span>, <span class="number">0xBE</span>, <span class="number">0x39</span>, <span class="number">0x4A</span>, <span class="number">0x4C</span>, <span class="number">0x58</span>, <span class="number">0xCF</span>],  </span><br><span class="line">             [<span class="number">0xD0</span>, <span class="number">0xEF</span>, <span class="number">0xAA</span>, <span class="number">0xFB</span>, <span class="number">0x43</span>, <span class="number">0x4D</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xF9</span>, <span class="number">0x02</span>, <span class="number">0x7F</span>, <span class="number">0x50</span>, <span class="number">0x3C</span>, <span class="number">0x9F</span>, <span class="number">0xA8</span>],  </span><br><span class="line">             [<span class="number">0x51</span>, <span class="number">0xA3</span>, <span class="number">0x40</span>, <span class="number">0x8F</span>, <span class="number">0x92</span>, <span class="number">0x9D</span>, <span class="number">0x38</span>, <span class="number">0xF5</span>, <span class="number">0xBC</span>, <span class="number">0xB6</span>, <span class="number">0xDA</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xFF</span>, <span class="number">0xF3</span>, <span class="number">0xD2</span>],  </span><br><span class="line">             [<span class="number">0xCD</span>, <span class="number">0x0C</span>, <span class="number">0x13</span>, <span class="number">0xEC</span>, <span class="number">0x5F</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xC4</span>, <span class="number">0xA7</span>, <span class="number">0x7E</span>, <span class="number">0x3D</span>, <span class="number">0x64</span>, <span class="number">0x5D</span>, <span class="number">0x19</span>, <span class="number">0x73</span>],  </span><br><span class="line">             [<span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4F</span>, <span class="number">0xDC</span>, <span class="number">0x22</span>, <span class="number">0x2A</span>, <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xEE</span>, <span class="number">0xB8</span>, <span class="number">0x14</span>, <span class="number">0xDE</span>, <span class="number">0x5E</span>, <span class="number">0x0B</span>, <span class="number">0xDB</span>],  </span><br><span class="line">             [<span class="number">0xE0</span>, <span class="number">0x32</span>, <span class="number">0x3A</span>, <span class="number">0x0A</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5C</span>, <span class="number">0xC2</span>, <span class="number">0xD3</span>, <span class="number">0xAC</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xE4</span>, <span class="number">0x79</span>],  </span><br><span class="line">             [<span class="number">0xE7</span>, <span class="number">0xC8</span>, <span class="number">0x37</span>, <span class="number">0x6D</span>, <span class="number">0x8D</span>, <span class="number">0xD5</span>, <span class="number">0x4E</span>, <span class="number">0xA9</span>, <span class="number">0x6C</span>, <span class="number">0x56</span>, <span class="number">0xF4</span>, <span class="number">0xEA</span>, <span class="number">0x65</span>, <span class="number">0x7A</span>, <span class="number">0xAE</span>, <span class="number">0x08</span>],  </span><br><span class="line">             [<span class="number">0xBA</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2E</span>, <span class="number">0x1C</span>, <span class="number">0xA6</span>, <span class="number">0xB4</span>, <span class="number">0xC6</span>, <span class="number">0xE8</span>, <span class="number">0xDD</span>, <span class="number">0x74</span>, <span class="number">0x1F</span>, <span class="number">0x4B</span>, <span class="number">0xBD</span>, <span class="number">0x8B</span>, <span class="number">0x8A</span>],  </span><br><span class="line">             [<span class="number">0x70</span>, <span class="number">0x3E</span>, <span class="number">0xB5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xF6</span>, <span class="number">0x0E</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xB9</span>, <span class="number">0x86</span>, <span class="number">0xC1</span>, <span class="number">0x1D</span>, <span class="number">0x9E</span>],  </span><br><span class="line">             [<span class="number">0xE1</span>, <span class="number">0xF8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xD9</span>, <span class="number">0x8E</span>, <span class="number">0x94</span>, <span class="number">0x9B</span>, <span class="number">0x1E</span>, <span class="number">0x87</span>, <span class="number">0xE9</span>, <span class="number">0xCE</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xDF</span>],  </span><br><span class="line">             [<span class="number">0x8C</span>, <span class="number">0xA1</span>, <span class="number">0x89</span>, <span class="number">0x0D</span>, <span class="number">0xBF</span>, <span class="number">0xE6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x2D</span>, <span class="number">0x0F</span>, <span class="number">0xB0</span>, <span class="number">0x54</span>, <span class="number">0xBB</span>, <span class="number">0x16</span>]]  </span><br><span class="line">  </span><br><span class="line">    I_SBOX = [[<span class="number">0x52</span>, <span class="number">0x09</span>, <span class="number">0x6A</span>, <span class="number">0xD5</span>, <span class="number">0x30</span>, <span class="number">0x36</span>, <span class="number">0xA5</span>, <span class="number">0x38</span>, <span class="number">0xBF</span>, <span class="number">0x40</span>, <span class="number">0xA3</span>, <span class="number">0x9E</span>, <span class="number">0x81</span>, <span class="number">0xF3</span>, <span class="number">0xD7</span>, <span class="number">0xFB</span>],  </span><br><span class="line">              [<span class="number">0x7C</span>, <span class="number">0xE3</span>, <span class="number">0x39</span>, <span class="number">0x82</span>, <span class="number">0x9B</span>, <span class="number">0x2F</span>, <span class="number">0xFF</span>, <span class="number">0x87</span>, <span class="number">0x34</span>, <span class="number">0x8E</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0xC4</span>, <span class="number">0xDE</span>, <span class="number">0xE9</span>, <span class="number">0xCB</span>],  </span><br><span class="line">              [<span class="number">0x54</span>, <span class="number">0x7B</span>, <span class="number">0x94</span>, <span class="number">0x32</span>, <span class="number">0xA6</span>, <span class="number">0xC2</span>, <span class="number">0x23</span>, <span class="number">0x3D</span>, <span class="number">0xEE</span>, <span class="number">0x4C</span>, <span class="number">0x95</span>, <span class="number">0x0B</span>, <span class="number">0x42</span>, <span class="number">0xFA</span>, <span class="number">0xC3</span>, <span class="number">0x4E</span>],  </span><br><span class="line">              [<span class="number">0x08</span>, <span class="number">0x2E</span>, <span class="number">0xA1</span>, <span class="number">0x66</span>, <span class="number">0x28</span>, <span class="number">0xD9</span>, <span class="number">0x24</span>, <span class="number">0xB2</span>, <span class="number">0x76</span>, <span class="number">0x5B</span>, <span class="number">0xA2</span>, <span class="number">0x49</span>, <span class="number">0x6D</span>, <span class="number">0x8B</span>, <span class="number">0xD1</span>, <span class="number">0x25</span>],  </span><br><span class="line">              [<span class="number">0x72</span>, <span class="number">0xF8</span>, <span class="number">0xF6</span>, <span class="number">0x64</span>, <span class="number">0x86</span>, <span class="number">0x68</span>, <span class="number">0x98</span>, <span class="number">0x16</span>, <span class="number">0xD4</span>, <span class="number">0xA4</span>, <span class="number">0x5C</span>, <span class="number">0xCC</span>, <span class="number">0x5D</span>, <span class="number">0x65</span>, <span class="number">0xB6</span>, <span class="number">0x92</span>],  </span><br><span class="line">              [<span class="number">0x6C</span>, <span class="number">0x70</span>, <span class="number">0x48</span>, <span class="number">0x50</span>, <span class="number">0xFD</span>, <span class="number">0xED</span>, <span class="number">0xB9</span>, <span class="number">0xDA</span>, <span class="number">0x5E</span>, <span class="number">0x15</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0xA7</span>, <span class="number">0x8D</span>, <span class="number">0x9D</span>, <span class="number">0x84</span>],  </span><br><span class="line">              [<span class="number">0x90</span>, <span class="number">0xD8</span>, <span class="number">0xAB</span>, <span class="number">0x00</span>, <span class="number">0x8C</span>, <span class="number">0xBC</span>, <span class="number">0xD3</span>, <span class="number">0x0A</span>, <span class="number">0xF7</span>, <span class="number">0xE4</span>, <span class="number">0x58</span>, <span class="number">0x05</span>, <span class="number">0xB8</span>, <span class="number">0xB3</span>, <span class="number">0x45</span>, <span class="number">0x06</span>],  </span><br><span class="line">              [<span class="number">0xD0</span>, <span class="number">0x2C</span>, <span class="number">0x1E</span>, <span class="number">0x8F</span>, <span class="number">0xCA</span>, <span class="number">0x3F</span>, <span class="number">0x0F</span>, <span class="number">0x02</span>, <span class="number">0xC1</span>, <span class="number">0xAF</span>, <span class="number">0xBD</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x13</span>, <span class="number">0x8A</span>, <span class="number">0x6B</span>],  </span><br><span class="line">              [<span class="number">0x3A</span>, <span class="number">0x91</span>, <span class="number">0x11</span>, <span class="number">0x41</span>, <span class="number">0x4F</span>, <span class="number">0x67</span>, <span class="number">0xDC</span>, <span class="number">0xEA</span>, <span class="number">0x97</span>, <span class="number">0xF2</span>, <span class="number">0xCF</span>, <span class="number">0xCE</span>, <span class="number">0xF0</span>, <span class="number">0xB4</span>, <span class="number">0xE6</span>, <span class="number">0x73</span>],  </span><br><span class="line">              [<span class="number">0x96</span>, <span class="number">0xAC</span>, <span class="number">0x74</span>, <span class="number">0x22</span>, <span class="number">0xE7</span>, <span class="number">0xAD</span>, <span class="number">0x35</span>, <span class="number">0x85</span>, <span class="number">0xE2</span>, <span class="number">0xF9</span>, <span class="number">0x37</span>, <span class="number">0xE8</span>, <span class="number">0x1C</span>, <span class="number">0x75</span>, <span class="number">0xDF</span>, <span class="number">0x6E</span>],  </span><br><span class="line">              [<span class="number">0x47</span>, <span class="number">0xF1</span>, <span class="number">0x1A</span>, <span class="number">0x71</span>, <span class="number">0x1D</span>, <span class="number">0x29</span>, <span class="number">0xC5</span>, <span class="number">0x89</span>, <span class="number">0x6F</span>, <span class="number">0xB7</span>, <span class="number">0x62</span>, <span class="number">0x0E</span>, <span class="number">0xAA</span>, <span class="number">0x18</span>, <span class="number">0xBE</span>, <span class="number">0x1B</span>],  </span><br><span class="line">              [<span class="number">0xFC</span>, <span class="number">0x56</span>, <span class="number">0x3E</span>, <span class="number">0x4B</span>, <span class="number">0xC6</span>, <span class="number">0xD2</span>, <span class="number">0x79</span>, <span class="number">0x20</span>, <span class="number">0x9A</span>, <span class="number">0xDB</span>, <span class="number">0xC0</span>, <span class="number">0xFE</span>, <span class="number">0x78</span>, <span class="number">0xCD</span>, <span class="number">0x5A</span>, <span class="number">0xF4</span>],  </span><br><span class="line">              [<span class="number">0x1F</span>, <span class="number">0xDD</span>, <span class="number">0xA8</span>, <span class="number">0x33</span>, <span class="number">0x88</span>, <span class="number">0x07</span>, <span class="number">0xC7</span>, <span class="number">0x31</span>, <span class="number">0xB1</span>, <span class="number">0x12</span>, <span class="number">0x10</span>, <span class="number">0x59</span>, <span class="number">0x27</span>, <span class="number">0x80</span>, <span class="number">0xEC</span>, <span class="number">0x5F</span>],  </span><br><span class="line">              [<span class="number">0x60</span>, <span class="number">0x51</span>, <span class="number">0x7F</span>, <span class="number">0xA9</span>, <span class="number">0x19</span>, <span class="number">0xB5</span>, <span class="number">0x4A</span>, <span class="number">0x0D</span>, <span class="number">0x2D</span>, <span class="number">0xE5</span>, <span class="number">0x7A</span>, <span class="number">0x9F</span>, <span class="number">0x93</span>, <span class="number">0xC9</span>, <span class="number">0x9C</span>, <span class="number">0xEF</span>],  </span><br><span class="line">              [<span class="number">0xA0</span>, <span class="number">0xE0</span>, <span class="number">0x3B</span>, <span class="number">0x4D</span>, <span class="number">0xAE</span>, <span class="number">0x2A</span>, <span class="number">0xF5</span>, <span class="number">0xB0</span>, <span class="number">0xC8</span>, <span class="number">0xEB</span>, <span class="number">0xBB</span>, <span class="number">0x3C</span>, <span class="number">0x83</span>, <span class="number">0x53</span>, <span class="number">0x99</span>, <span class="number">0x61</span>],  </span><br><span class="line">              [<span class="number">0x17</span>, <span class="number">0x2B</span>, <span class="number">0x04</span>, <span class="number">0x7E</span>, <span class="number">0xBA</span>, <span class="number">0x77</span>, <span class="number">0xD6</span>, <span class="number">0x26</span>, <span class="number">0xE1</span>, <span class="number">0x69</span>, <span class="number">0x14</span>, <span class="number">0x63</span>, <span class="number">0x55</span>, <span class="number">0x21</span>, <span class="number">0x0C</span>, <span class="number">0x7D</span>]]  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">SubBytes</span>(<span class="params">self, State</span>):  </span><br><span class="line">        <span class="comment"># 字节替换  </span></span><br><span class="line">        <span class="keyword">return</span> [<span class="variable language_">self</span>.S_BOX[i][j] <span class="keyword">for</span> i, j <span class="keyword">in</span>   </span><br><span class="line">               [(_ &gt;&gt; <span class="number">4</span>, _ &amp; <span class="number">0xF</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> State]]  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">SubBytes_Inv</span>(<span class="params">self, State</span>):  </span><br><span class="line">        <span class="comment"># 字节逆替换  </span></span><br><span class="line">        <span class="keyword">return</span> [<span class="variable language_">self</span>.I_SBOX[i][j] <span class="keyword">for</span> i, j <span class="keyword">in</span>  </span><br><span class="line">               [(_ &gt;&gt; <span class="number">4</span>, _ &amp; <span class="number">0xF</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> State]]  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">ShiftRows</span>(<span class="params">self, S</span>):  </span><br><span class="line">        <span class="comment"># 行移位  </span></span><br><span class="line">        <span class="keyword">return</span> [S[ <span class="number">0</span>], S[ <span class="number">5</span>], S[<span class="number">10</span>], S[<span class="number">15</span>],   </span><br><span class="line">                S[ <span class="number">4</span>], S[ <span class="number">9</span>], S[<span class="number">14</span>], S[ <span class="number">3</span>],  </span><br><span class="line">                S[ <span class="number">8</span>], S[<span class="number">13</span>], S[ <span class="number">2</span>], S[ <span class="number">7</span>],  </span><br><span class="line">                S[<span class="number">12</span>], S[ <span class="number">1</span>], S[ <span class="number">6</span>], S[<span class="number">11</span>]]  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">ShiftRows_Inv</span>(<span class="params">self, S</span>):  </span><br><span class="line">        <span class="comment"># 逆行移位  </span></span><br><span class="line">        <span class="keyword">return</span> [S[ <span class="number">0</span>], S[<span class="number">13</span>], S[<span class="number">10</span>], S[ <span class="number">7</span>],  </span><br><span class="line">                S[ <span class="number">4</span>], S[ <span class="number">1</span>], S[<span class="number">14</span>], S[<span class="number">11</span>],  </span><br><span class="line">                S[ <span class="number">8</span>], S[ <span class="number">5</span>], S[ <span class="number">2</span>], S[<span class="number">15</span>],  </span><br><span class="line">                S[<span class="number">12</span>], S[ <span class="number">9</span>], S[ <span class="number">6</span>], S[ <span class="number">3</span>]]  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">MixColumns</span>(<span class="params">self, State</span>):  </span><br><span class="line">        <span class="comment"># 列混合  </span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.Matrix_Mul(<span class="variable language_">self</span>.MIX_C, State)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">MixColumns_Inv</span>(<span class="params">self, State</span>):  </span><br><span class="line">        <span class="comment"># 逆列混合  </span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.Matrix_Mul(<span class="variable language_">self</span>.I_MIXC, State)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">RotWord</span>(<span class="params">self, _4byte_block</span>):  </span><br><span class="line">        <span class="comment"># 用于生成轮密钥的字移位  </span></span><br><span class="line">        <span class="keyword">return</span> ((_4byte_block &amp; <span class="number">0xffffff</span>) &lt;&lt; <span class="number">8</span>) + (_4byte_block &gt;&gt; <span class="number">24</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">SubWord</span>(<span class="params">self, _4byte_block</span>):  </span><br><span class="line">        <span class="comment"># 用于生成密钥的字节替换  </span></span><br><span class="line">        result = <span class="number">0</span>  </span><br><span class="line">        <span class="keyword">for</span> position <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):  </span><br><span class="line">            i = _4byte_block &gt;&gt; position * <span class="number">8</span> + <span class="number">4</span> &amp; <span class="number">0xf</span>  </span><br><span class="line">            j = _4byte_block &gt;&gt; position * <span class="number">8</span> &amp; <span class="number">0xf</span>  </span><br><span class="line">            result ^= <span class="variable language_">self</span>.S_BOX[i][j] &lt;&lt; position * <span class="number">8</span>  </span><br><span class="line">        <span class="keyword">return</span> result  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mod</span>(<span class="params">self, poly, mod = <span class="number">0b100011011</span></span>):    </span><br><span class="line">        <span class="comment"># poly模多项式mod  </span></span><br><span class="line">        <span class="keyword">while</span> poly.bit_length() &gt; <span class="number">8</span>:  </span><br><span class="line">            poly ^= mod &lt;&lt; poly.bit_length() - <span class="number">9</span>  </span><br><span class="line">        <span class="keyword">return</span> poly  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">self, poly1, poly2</span>):  </span><br><span class="line">        <span class="comment"># 多项式相乘  </span></span><br><span class="line">        result = <span class="number">0</span>  </span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(poly2.bit_length()):  </span><br><span class="line">            <span class="keyword">if</span> poly2 &amp; <span class="number">1</span> &lt;&lt; index:  </span><br><span class="line">                result ^= poly1 &lt;&lt; index  </span><br><span class="line">        <span class="keyword">return</span> result  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Matrix_Mul</span>(<span class="params">self, M1, M2</span>):  <span class="comment"># M1 = MIX_C  M2 = State  </span></span><br><span class="line">        <span class="comment"># 用于列混合的矩阵相乘  </span></span><br><span class="line">        M = [<span class="number">0</span>] * <span class="number">16</span>  </span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):  </span><br><span class="line">            <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):  </span><br><span class="line">                <span class="keyword">for</span> Round <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):  </span><br><span class="line">                    M[row + col*<span class="number">4</span>] ^= <span class="variable language_">self</span>.mul(M1[row][Round], M2[Round+col*<span class="number">4</span>])  </span><br><span class="line">                M[row + col*<span class="number">4</span>] = <span class="variable language_">self</span>.mod(M[row + col*<span class="number">4</span>])  </span><br><span class="line">        <span class="keyword">return</span> M  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">round_key_generator</span>(<span class="params">self, _16bytes_key</span>):  </span><br><span class="line">        <span class="comment"># 轮密钥产生  </span></span><br><span class="line">        w = [_16bytes_key &gt;&gt; <span class="number">96</span>,   </span><br><span class="line">             _16bytes_key &gt;&gt; <span class="number">64</span> &amp; <span class="number">0xFFFFFFFF</span>,   </span><br><span class="line">             _16bytes_key &gt;&gt; <span class="number">32</span> &amp; <span class="number">0xFFFFFFFF</span>,   </span><br><span class="line">             _16bytes_key &amp; <span class="number">0xFFFFFFFF</span>] + [<span class="number">0</span>]*<span class="number">40</span>  </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>, <span class="number">44</span>):  </span><br><span class="line">            temp = w[i-<span class="number">1</span>]  </span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> i % <span class="number">4</span>:  </span><br><span class="line">                temp = <span class="variable language_">self</span>.SubWord(<span class="variable language_">self</span>.RotWord(temp)) ^ <span class="variable language_">self</span>.RCon[i//<span class="number">4</span>-<span class="number">1</span>]  </span><br><span class="line">            w[i] = w[i-<span class="number">4</span>] ^ temp  </span><br><span class="line">        <span class="keyword">return</span> [<span class="variable language_">self</span>.num_2_16bytes(  </span><br><span class="line">                    <span class="built_in">sum</span>([w[<span class="number">4</span> * i] &lt;&lt; <span class="number">96</span>, w[<span class="number">4</span>*i+<span class="number">1</span>] &lt;&lt; <span class="number">64</span>,   </span><br><span class="line">                         w[<span class="number">4</span>*i+<span class="number">2</span>] &lt;&lt; <span class="number">32</span>, w[<span class="number">4</span>*i+<span class="number">3</span>]])  </span><br><span class="line">                    ) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">11</span>)]  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">AddRoundKey</span>(<span class="params">self, State, RoundKeys, index</span>):  </span><br><span class="line">        <span class="comment"># 异或轮密钥  </span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._16bytes_xor(State, RoundKeys[index])  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_16bytes_xor</span>(<span class="params">self, _16bytes_1, _16bytes_2</span>):  </span><br><span class="line">        <span class="keyword">return</span> [_16bytes_1[i] ^ _16bytes_2[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)]  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_16bytes2num</span>(<span class="params">cls, _16<span class="built_in">bytes</span></span>):  </span><br><span class="line">        <span class="comment"># 16字节转数字  </span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>.from_bytes(_16<span class="built_in">bytes</span>, byteorder = <span class="string">&#x27;big&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">num_2_16bytes</span>(<span class="params">cls, num</span>):  </span><br><span class="line">        <span class="comment"># 数字转16字节  </span></span><br><span class="line">        <span class="keyword">return</span> num.to_bytes(<span class="number">16</span>, byteorder = <span class="string">&#x27;big&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">aes_encrypt</span>(<span class="params">self, plaintext_list, RoundKeys</span>):  </span><br><span class="line">        State = plaintext_list  </span><br><span class="line">        State = <span class="variable language_">self</span>.AddRoundKey(State, RoundKeys, <span class="number">0</span>)  </span><br><span class="line">        <span class="keyword">for</span> Round <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>):  </span><br><span class="line">            State = <span class="variable language_">self</span>.SubBytes(State)  </span><br><span class="line">            State = <span class="variable language_">self</span>.ShiftRows(State)  </span><br><span class="line">            State = <span class="variable language_">self</span>.MixColumns(State)  </span><br><span class="line">            State = <span class="variable language_">self</span>.AddRoundKey(State, RoundKeys, Round)  </span><br><span class="line">        State = <span class="variable language_">self</span>.SubBytes(State)  </span><br><span class="line">        State = <span class="variable language_">self</span>.ShiftRows(State)  </span><br><span class="line">        State = <span class="variable language_">self</span>.AddRoundKey(State, RoundKeys, <span class="number">10</span>)  </span><br><span class="line">        <span class="keyword">return</span> State  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">aes_decrypt</span>(<span class="params">self, ciphertext_list, RoundKeys</span>):  </span><br><span class="line">        State = ciphertext_list  </span><br><span class="line">        State = <span class="variable language_">self</span>.AddRoundKey(State, RoundKeys, <span class="number">10</span>)  </span><br><span class="line">        <span class="keyword">for</span> Round <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>):  </span><br><span class="line">            State = <span class="variable language_">self</span>.ShiftRows_Inv(State)  </span><br><span class="line">            State = <span class="variable language_">self</span>.SubBytes_Inv(State)  </span><br><span class="line">            State = <span class="variable language_">self</span>.AddRoundKey(State, RoundKeys, <span class="number">10</span>-Round)  </span><br><span class="line">            State = <span class="variable language_">self</span>.MixColumns_Inv(State)  </span><br><span class="line">        State = <span class="variable language_">self</span>.ShiftRows_Inv(State)  </span><br><span class="line">        State = <span class="variable language_">self</span>.SubBytes_Inv(State)  </span><br><span class="line">        State = <span class="variable language_">self</span>.AddRoundKey(State, RoundKeys, <span class="number">0</span>)  </span><br><span class="line">        <span class="keyword">return</span> State  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">  </span><br><span class="line">    aes = AES()  </span><br><span class="line">    key = <span class="number">0x000102030405060708090a0b0c0d0e0f</span>  </span><br><span class="line">    RoundKeys = aes.round_key_generator(key)  </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 加密  </span></span><br><span class="line">    plaintext = <span class="number">0x00112233445566778899aabbccddeeff</span>  </span><br><span class="line">    <span class="comment"># 0x00112233445566778899aabbccddeeff -&gt; b&#x27;\x00\x11&quot;3DUfw\x88\x99\xaa\xbb\xcc\xdd\xee\xff&#x27;  </span></span><br><span class="line">    plaintext = aes.num_2_16bytes(plaintext)  </span><br><span class="line">    ciphertext = aes.aes_encrypt(plaintext, RoundKeys)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ciphertext = &#x27;</span> + <span class="built_in">hex</span>(aes._16bytes2num(ciphertext)))  </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 解密  </span></span><br><span class="line">    ciphertext = <span class="number">0x69c4e0d86a7b0430d8cdb78070b4c55a</span>  </span><br><span class="line">    ciphertext = aes.num_2_16bytes(ciphertext)  </span><br><span class="line">    plaintext = aes.aes_decrypt(ciphertext, RoundKeys)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;plaintext = &#x27;</span> + <span class="built_in">hex</span>(aes._16bytes2num(plaintext)))  </span><br></pre></td></tr></table></figure>
<p>若要使用Python的第三方库，可简化为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Cipher import AES  </span><br><span class="line">  </span><br><span class="line">password = b&#x27;1234567812345678&#x27; #秘钥，b就是表示为bytes类型  </span><br><span class="line">text = b&#x27;abcdefghijklmnhi&#x27; #需要加密的内容，bytes类型  </span><br><span class="line">aes = AES.new(password,AES.MODE_ECB) #创建一个aes对象  </span><br><span class="line"># AES.MODE_ECB 表示模式是ECB模式  </span><br><span class="line">en_text = aes.encrypt(text) #加密明文  </span><br><span class="line">print(&quot;密文：&quot;,en_text) #加密明文，bytes类型  </span><br><span class="line">den_text = aes.decrypt(en_text) # 解密密文  </span><br><span class="line">print(&quot;明文：&quot;,den_text)  </span><br></pre></td></tr></table></figure>
<p>这样使用要先安装对应的库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip uninstall crypto  </span><br><span class="line">pip uninstall pycryptodome  </span><br><span class="line">pip install pycryptodome  </span><br></pre></td></tr></table></figure>
<h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><p>NepNep的面试题（题倒是做出来了，可惜最后也没能被录用，卡在面试上了）</p>
<p>Die查个壳先，Windows64位无壳，直接拖进IDA分析</p>
<p>定位到main函数，发现未分析为代码大量数据块，直接按C就能分析成汇编代码，由于使用故意除以零出发异常、代码自修改和栈帧破坏（用rbx作为新的基指针代替rbp）等混淆方式无法F5，只能啃汇编。在AI帮助和定位几个交互的语句大致定位出输入输出和部分关键代码的位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line">.text:00000001400032BF                             loc_1400032BF:                          ; CODE XREF: main:loc_1400032BA↑j  </span><br><span class="line">.text:00000001400032BF -08 90                                      nop  </span><br><span class="line">.text:00000001400032C0 -08 44 8A 43 5D                             mov     r8b, [rbx+5Dh]  </span><br><span class="line">.text:00000001400032C4 -08 8A 53 5E                                mov     dl, [rbx+5Eh]  </span><br><span class="line">.text:00000001400032C7 -08 8A 4B 5F                                mov     cl, [rbx+5Fh]  </span><br><span class="line">.text:00000001400032CA -08 48 8D 43 60                             lea     rax, [rbx+60h]  </span><br><span class="line">.text:00000001400032CE -08 48 89 83 48 01 00 00                    mov     [rbx+148h], rax  </span><br><span class="line">.text:00000001400032D5 -08 44 88 83 47 01 00 00                    mov     [rbx+147h], r8b  </span><br><span class="line">.text:00000001400032DC -08 88 93 46 01 00 00                       mov     [rbx+146h], dl  </span><br><span class="line">.text:00000001400032E2 -08 88 8B 45 01 00 00                       mov     [rbx+145h], cl  </span><br><span class="line">.text:00000001400032E8 -08 48 89 83 58 01 00 00                    mov     [rbx+158h], rax  </span><br><span class="line">.text:00000001400032EF -08 48 8B 8B 58 01 00 00                    mov     rcx, [rbx+158h]  </span><br><span class="line">.text:00000001400032F6 -08 48 89 8B D0 01 00 00                    mov     [rbx+1D0h], rcx  </span><br><span class="line">.text:00000001400032FD -08 48 8B 8B D0 01 00 00                    mov     rcx, [rbx+1D0h]  </span><br><span class="line">.text:0000000140003304 -08 48 89 4B 28                             mov     [rbx+28h], rcx  </span><br><span class="line">.text:0000000140003308 -08 C5 F8 57 C0                             vxorps  xmm0, xmm0, xmm0  </span><br><span class="line">.text:000000014000330C -08 C5 FC 11 83 B0 01 00 00                 vmovups ymmword ptr [rbx+1B0h], ymm0  </span><br><span class="line">.text:0000000140003314 -08 C5 FC 29 83 A0 01 00 00                 vmovaps ymmword ptr [rbx+1A0h], ymm0  </span><br><span class="line">.text:000000014000331C -08 48 BE 6D 75 F6 53 12 DF                 mov     rsi, 92DFDF1253F6756Dh ; KEY_DATA  </span><br><span class="line">.text:000000014000331C -08 DF 92  </span><br><span class="line">.text:0000000140003326 -08 48 89 B3 A0 01 00 00                    mov     [rbx+1A0h], rsi  </span><br><span class="line">.text:000000014000332D -08 49 BB 0C 6D CC E8 91 A2                 mov     r11, 9619A291E8CC6D0Ch  </span><br><span class="line">.text:000000014000332D -08 19 96  </span><br><span class="line">.text:0000000140003337 -08 4C 89 9B A8 01 00 00                    mov     [rbx+1A8h], r11  </span><br><span class="line">.text:000000014000333E -08 49 BA 85 17 C6 AC BC FF                 mov     r10, 873FFFBCACC61785h  </span><br><span class="line">.text:000000014000333E -08 3F 87  </span><br><span class="line">.text:0000000140003348 -08 4C 89 93 B0 01 00 00                    mov     [rbx+1B0h], r10  </span><br><span class="line">.text:000000014000334F -08 49 B9 8C 96 47 00 2D B6                 mov     r9, 0E47DB62D0047968Ch  </span><br><span class="line">.text:000000014000334F -08 7D E4  </span><br><span class="line">.text:0000000140003359 -08 4C 89 8B B8 01 00 00                    mov     [rbx+1B8h], r9  </span><br><span class="line">.text:0000000140003360 -08 49 B8 F2 38 89 33 B0 88                 mov     r8, 2A088B0338938F2h  </span><br><span class="line">.text:0000000140003360 -08 A0 02  </span><br><span class="line">.text:000000014000336A -08 4C 89 83 C0 01 00 00                    mov     [rbx+1C0h], r8  </span><br><span class="line">.text:0000000140003371 -08 48 BA FD 34 D3 55 D5 51                 mov     rdx, 44F651D555D334FDh  </span><br><span class="line">.text:0000000140003371 -08 F6 44  </span><br><span class="line">.text:000000014000337B -08 48 89 93 C8 01 00 00                    mov     [rbx+1C8h], rdx  </span><br><span class="line">.text:0000000140003382 -08 48 8B BB A0 01 00 00                    mov     rdi, [rbx+1A0h]  </span><br><span class="line">.text:0000000140003389 -08 48 89 39                                mov     [rcx], rdi  </span><br><span class="line">.text:000000014000338C -08 48 8B 39                                mov     rdi, [rcx]  </span><br><span class="line">.text:000000014000338F -08 48 89 BB 70 01 00 00                    mov     [rbx+170h], rdi  </span><br><span class="line">.text:0000000140003396 -08 48 8B BB A8 01 00 00                    mov     rdi, [rbx+1A8h]  </span><br><span class="line">.text:000000014000339D -08 48 89 79 08                             mov     [rcx+8], rdi  </span><br><span class="line">.text:00000001400033A1 -08 48 8B 79 08                             mov     rdi, [rcx+8]  </span><br><span class="line">.text:00000001400033A5 -08 48 89 BB 78 01 00 00                    mov     [rbx+178h], rdi  </span><br><span class="line">.text:00000001400033AC -08 48 8B BB B0 01 00 00                    mov     rdi, [rbx+1B0h]  </span><br><span class="line">.text:00000001400033B3 -08 48 89 79 10                             mov     [rcx+10h], rdi  </span><br><span class="line">.text:00000001400033B7 -08 48 8B 79 10                             mov     rdi, [rcx+10h]  </span><br><span class="line">.text:00000001400033BB -08 48 89 BB 80 01 00 00                    mov     [rbx+180h], rdi  </span><br><span class="line">.text:00000001400033C2 -08 48 8B BB B8 01 00 00                    mov     rdi, [rbx+1B8h]  </span><br><span class="line">.text:00000001400033C9 -08 48 89 79 18                             mov     [rcx+18h], rdi  </span><br><span class="line">.text:00000001400033CD -08 48 8B 79 18                             mov     rdi, [rcx+18h]  </span><br><span class="line">.text:00000001400033D1 -08 48 89 BB 88 01 00 00                    mov     [rbx+188h], rdi  </span><br><span class="line">.text:00000001400033D8 -08 48 8B BB C0 01 00 00                    mov     rdi, [rbx+1C0h]  </span><br><span class="line">.text:00000001400033DF -08 48 89 79 20                             mov     [rcx+20h], rdi  </span><br><span class="line">.text:00000001400033E3 -08 48 8B 79 20                             mov     rdi, [rcx+20h]  </span><br><span class="line">.text:00000001400033E7 -08 48 89 BB 90 01 00 00                    mov     [rbx+190h], rdi  </span><br><span class="line">.text:00000001400033EE -08 48 8B BB C8 01 00 00                    mov     rdi, [rbx+1C8h]  </span><br><span class="line">.text:00000001400033F5 -08 48 89 79 28                             mov     [rcx+28h], rdi  </span><br><span class="line">.text:00000001400033F9 -08 48 8B 49 28                             mov     rcx, [rcx+28h]  </span><br><span class="line">.text:00000001400033FD -08 48 89 8B 98 01 00 00                    mov     [rbx+198h], rcx  </span><br><span class="line">.text:0000000140003404 -08 48 8D 8B 70 01 00 00                    lea     rcx, [rbx+170h]  </span><br><span class="line">.text:000000014000340B -08 48 89 8B 60 01 00 00                    mov     [rbx+160h], rcx  </span><br><span class="line">.text:0000000140003412 -08 48 8D 8B A0 01 00 00                    lea     rcx, [rbx+1A0h]  </span><br><span class="line">.text:0000000140003419 -08 48 89 8B 68 01 00 00                    mov     [rbx+168h], rcx  </span><br><span class="line">.text:0000000140003420 -08 48 89 83 50 01 00 00                    mov     [rbx+150h], rax  </span><br><span class="line">.text:0000000140003427 -08 48 8B 83 50 01 00 00                    mov     rax, [rbx+150h]  </span><br><span class="line">.text:000000014000342E -08 48 89 43 40                             mov     [rbx+40h], rax  </span><br><span class="line">.text:0000000140003432 -08 48 89 83 58 02 00 00                    mov     [rbx+258h], rax  </span><br><span class="line">.text:0000000140003439 -08 48 8B 83 58 02 00 00                    mov     rax, [rbx+258h]  </span><br><span class="line">.text:0000000140003440 -08 48 B9 1F 34 90 3F 60 A7                 mov     rcx, 0E795A7603F90341Fh ; FAKE_FLAG  </span><br><span class="line">.text:0000000140003440 -08 95 E7  </span><br><span class="line">.text:000000014000344A -08 48 89 8B 20 02 00 00                    mov     [rbx+220h], rcx  </span><br><span class="line">.text:0000000140003451 -08 48 8B 8B 20 02 00 00                    mov     rcx, [rbx+220h]  </span><br><span class="line">.text:0000000140003458 -08 48 89 8B F0 01 00 00                    mov     [rbx+1F0h], rcx  </span><br><span class="line">.text:000000014000345F -08 48 B9 3C 09 AA 9C E9 F3                 mov     rcx, 0C65BF3E99CAA093Ch  </span><br><span class="line">.text:000000014000345F -08 5B C6  </span><br><span class="line">.text:0000000140003469 -08 48 89 8B 28 02 00 00                    mov     [rbx+228h], rcx  </span><br><span class="line">.text:0000000140003470 -08 48 8B 8B 28 02 00 00                    mov     rcx, [rbx+228h]  </span><br><span class="line">.text:0000000140003477 -08 48 89 8B F8 01 00 00                    mov     [rbx+1F8h], rcx  </span><br><span class="line">.text:000000014000347E -08 48 B9 E9 60 A0 99 C6 BC                 mov     rcx, 0CF59BCC699A060E9h  </span><br><span class="line">.text:000000014000347E -08 59 CF  </span><br><span class="line">.text:0000000140003488 -08 48 89 8B 30 02 00 00                    mov     [rbx+230h], rcx  </span><br><span class="line">.text:000000014000348F -08 48 8B 8B 30 02 00 00                    mov     rcx, [rbx+230h]  </span><br><span class="line">.text:0000000140003496 -08 48 89 8B 00 02 00 00                    mov     [rbx+200h], rcx  </span><br><span class="line">.text:000000014000349D -08 48 B9 F6 E1 31 42 57 C0                 mov     rcx, 0A727C0574231E1F6h  </span><br><span class="line">.text:000000014000349D -08 27 A7  </span><br><span class="line">.text:00000001400034A7 -08 48 89 8B 38 02 00 00                    mov     [rbx+238h], rcx  </span><br><span class="line">.text:00000001400034AE -08 48 8B 8B 38 02 00 00                    mov     rcx, [rbx+238h]  </span><br><span class="line">.text:00000001400034B5 -08 48 89 8B 08 02 00 00                    mov     [rbx+208h], rcx  </span><br><span class="line">.text:00000001400034BC -08 48 B9 C3 5F FF 77 DC FC                 mov     rcx, 52C9FCDC77FF5FC3h  </span><br><span class="line">.text:00000001400034BC -08 C9 52  </span><br><span class="line">.text:00000001400034C6 -08 48 89 8B 40 02 00 00                    mov     [rbx+240h], rcx  </span><br><span class="line">.text:00000001400034CD -08 48 8B 8B 40 02 00 00                    mov     rcx, [rbx+240h]  </span><br><span class="line">.text:00000001400034D4 -08 48 89 8B 10 02 00 00                    mov     [rbx+210h], rcx  </span><br><span class="line">.text:00000001400034DB -08 48 B9 90 60 82 68 D5 51                 mov     rcx, 44F651D568826090h  </span><br><span class="line">.text:00000001400034DB -08 F6 44  </span><br><span class="line">.text:00000001400034E5 -08 48 89 8B 48 02 00 00                    mov     [rbx+248h], rcx  </span><br><span class="line">.text:00000001400034EC -08 48 8B 8B 48 02 00 00                    mov     rcx, [rbx+248h]  </span><br><span class="line">.text:00000001400034F3 -08 48 89 8B 18 02 00 00                    mov     [rbx+218h], rcx  </span><br><span class="line">.text:00000001400034FA -08 48 8D 8B F0 01 00 00                    lea     rcx, [rbx+1F0h]  </span><br><span class="line">.text:0000000140003501 -08 48 89 8B E0 01 00 00                    mov     [rbx+1E0h], rcx  </span><br><span class="line">.text:0000000140003508 -08 48 8D 8B 20 02 00 00                    lea     rcx, [rbx+220h]  </span><br><span class="line">.text:000000014000350F -08 48 89 8B E8 01 00 00                    mov     [rbx+1E8h], rcx  </span><br><span class="line">.text:0000000140003516 -08 48 89 83 E8 02 00 00                    mov     [rbx+2E8h], rax  </span><br><span class="line">.text:000000014000351D -08 48 8B 8B E8 02 00 00                    mov     rcx, [rbx+2E8h]  </span><br><span class="line">.text:0000000140003524 -08 48 89 4B 30                             mov     [rbx+30h], rcx  </span><br><span class="line">.text:0000000140003528 -08 C5 FC 11 83 B0 02 00 00                 vmovups ymmword ptr [rbx+2B0h], ymm0  </span><br><span class="line">.text:0000000140003530 -08 C5 FC 29 83 A0 02 00 00                 vmovaps ymmword ptr [rbx+2A0h], ymm0  </span><br><span class="line">.text:0000000140003538 -08 48 89 B3 A0 02 00 00                    mov     [rbx+2A0h], rsi  </span><br><span class="line">.text:000000014000353F -08 4C 89 9B A8 02 00 00                    mov     [rbx+2A8h], r11  </span><br><span class="line">.text:0000000140003546 -08 4C 89 93 B0 02 00 00                    mov     [rbx+2B0h], r10  </span><br><span class="line">.text:000000014000354D -08 4C 89 8B B8 02 00 00                    mov     [rbx+2B8h], r9  </span><br><span class="line">.text:0000000140003554 -08 4C 89 83 C0 02 00 00                    mov     [rbx+2C0h], r8  </span><br><span class="line">.text:000000014000355B -08 48 89 93 C8 02 00 00                    mov     [rbx+2C8h], rdx  </span><br><span class="line">.text:0000000140003562 -08 48 8B 93 A0 02 00 00                    mov     rdx, [rbx+2A0h]  </span><br><span class="line">.text:0000000140003569 -08 48 89 11                                mov     [rcx], rdx  </span><br><span class="line">.text:000000014000356C -08 48 8B 11                                mov     rdx, [rcx]  </span><br><span class="line">.text:000000014000356F -08 48 89 93 70 02 00 00                    mov     [rbx+270h], rdx  </span><br><span class="line">.text:0000000140003576 -08 48 8B 93 A8 02 00 00                    mov     rdx, [rbx+2A8h]  </span><br><span class="line">.text:000000014000357D -08 48 89 51 08                             mov     [rcx+8], rdx  </span><br><span class="line">.text:0000000140003581 -08 48 8B 51 08                             mov     rdx, [rcx+8]  </span><br><span class="line">.text:0000000140003585 -08 48 89 93 78 02 00 00                    mov     [rbx+278h], rdx  </span><br><span class="line">.text:000000014000358C -08 48 8B 93 B0 02 00 00                    mov     rdx, [rbx+2B0h]  </span><br><span class="line">.text:0000000140003593 -08 48 89 51 10                             mov     [rcx+10h], rdx  </span><br><span class="line">.text:0000000140003597 -08 48 8B 51 10                             mov     rdx, [rcx+10h]  </span><br><span class="line">.text:000000014000359B -08 48 89 93 80 02 00 00                    mov     [rbx+280h], rdx  </span><br><span class="line">.text:00000001400035A2 -08 48 8B 93 B8 02 00 00                    mov     rdx, [rbx+2B8h]  </span><br><span class="line">.text:00000001400035A9 -08 48 89 51 18                             mov     [rcx+18h], rdx  </span><br><span class="line">.text:00000001400035AD -08 48 8B 51 18                             mov     rdx, [rcx+18h]  </span><br><span class="line">.text:00000001400035B1 -08 48 89 93 88 02 00 00                    mov     [rbx+288h], rdx  </span><br><span class="line">.text:00000001400035B8 -08 48 8B 93 C0 02 00 00                    mov     rdx, [rbx+2C0h]  </span><br><span class="line">.text:00000001400035BF -08 48 89 51 20                             mov     [rcx+20h], rdx  </span><br><span class="line">.text:00000001400035C3 -08 48 8B 51 20                             mov     rdx, [rcx+20h]  </span><br><span class="line">.text:00000001400035C7 -08 48 89 93 90 02 00 00                    mov     [rbx+290h], rdx  </span><br><span class="line">.text:00000001400035CE -08 48 8B 93 C8 02 00 00                    mov     rdx, [rbx+2C8h]  </span><br><span class="line">.text:00000001400035D5 -08 48 89 51 28                             mov     [rcx+28h], rdx  </span><br><span class="line">.text:00000001400035D9 -08 48 8B 49 28                             mov     rcx, [rcx+28h]  </span><br><span class="line">.text:00000001400035DD -08 48 89 8B 98 02 00 00                    mov     [rbx+298h], rcx  </span><br><span class="line">.text:00000001400035E4 -08 53                                      push    rbx  </span><br><span class="line">.text:00000001400035E5 000 9C                                      pushfq  </span><br><span class="line">.text:00000001400035E6 008 31 DB                                   xor     ebx, ebx  </span><br><span class="line">.text:00000001400035E8 008 85 DB                                   test    ebx, ebx  </span><br><span class="line">.text:00000001400035EA 008 75 2E                                   jnz     short near ptr loc_140003617+3  </span><br><span class="line">.text:00000001400035EC 008 0F 84 0E 00 00 00                       jz      loc_140003600  </span><br><span class="line">.text:00000001400035F2 008 C3                                      retn  </span><br></pre></td></tr></table></figure>
<p>此处的秘钥和密文通过异或+换表Base64得出了一个FAKEFLAG</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">key = [  </span><br><span class="line">    <span class="number">0x92DFDF1253F6756D</span>, <span class="number">0x9619A291E8CC6D0C</span>,  </span><br><span class="line">    <span class="number">0x873FFFBCACC61785</span>, <span class="number">0xE47DB62D0047968C</span>,  </span><br><span class="line">    <span class="number">0x0002A088B0338938F2</span>, <span class="number">0x44F651D555D334FD</span>  </span><br><span class="line">]  </span><br><span class="line">  </span><br><span class="line">expected = [  </span><br><span class="line">    <span class="number">0xE795A7603F90341F</span>, <span class="number">0xC65BF3E99CAA093C</span>,  </span><br><span class="line">    <span class="number">0xCF59BCC699A060E9</span>, <span class="number">0xA727C0574231E1F6</span>,  </span><br><span class="line">    <span class="number">0x52C9FCDC77FF5FC3</span>, <span class="number">0x44F651D568826090</span>  </span><br><span class="line">]  </span><br><span class="line">  </span><br><span class="line">flag = <span class="string">b&quot;&quot;</span>  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):  </span><br><span class="line">    <span class="comment"># 将64位整数转换为8字节  </span></span><br><span class="line">    key_bytes = key[i].to_bytes(<span class="number">8</span>, <span class="string">&#x27;little&#x27;</span>)  </span><br><span class="line">    exp_bytes = expected[i].to_bytes(<span class="number">8</span>, <span class="string">&#x27;little&#x27;</span>)  </span><br><span class="line">      </span><br><span class="line">    <span class="comment"># 逐字节异或解密  </span></span><br><span class="line">    <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(exp_bytes, key_bytes):  </span><br><span class="line">        flag += <span class="built_in">bytes</span>([a ^ b])  </span><br><span class="line">  </span><br><span class="line"><span class="built_in">print</span>(flag.decode(<span class="string">&#x27;utf-8&#x27;</span>))  </span><br><span class="line"><span class="comment"># 将表换为abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ+/  </span></span><br><span class="line"><span class="comment"># 解Base64得FAKE&#123;Th1S_Is-a_fakeeee_fleg-233&#125;  </span></span><br></pre></td></tr></table></figure>
<p>得到假FLAG后继续分析</p>
<p>实际的加密逻辑在如下位置：地址 off_140028348（17F271A60h） 指向的函数，跟着Success和Fail字符串定位到如下函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">sub_140002CF0</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span>  </span><br><span class="line">&#123;  </span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// eax  </span></span><br><span class="line">  <span class="type">char</span> v26[<span class="number">256</span>]; <span class="comment">// [rsp+180h] [rbp+100h] BYREF  </span></span><br><span class="line">  __m256 v27; <span class="comment">// [rsp+280h] [rbp+200h] BYREF  </span></span><br><span class="line">  __m256 v28[<span class="number">2</span>]; <span class="comment">// [rsp+2A0h] [rbp+220h] BYREF  </span></span><br><span class="line">  __m256 v29; <span class="comment">// [rsp+2E0h] [rbp+260h]  </span></span><br><span class="line">  __int64 v30; <span class="comment">// [rsp+300h] [rbp+280h]  </span></span><br><span class="line">  __int64 v31; <span class="comment">// [rsp+308h] [rbp+288h]  </span></span><br><span class="line">  __int64 v32; <span class="comment">// [rsp+310h] [rbp+290h]  </span></span><br><span class="line">  __int64 v33; <span class="comment">// [rsp+318h] [rbp+298h]  </span></span><br><span class="line">  __int64 v34[<span class="number">4</span>]; <span class="comment">// [rsp+320h] [rbp+2A0h] BYREF  </span></span><br><span class="line">  __m256 v35; <span class="comment">// [rsp+340h] [rbp+2C0h]  </span></span><br><span class="line">  __m256 v36; <span class="comment">// [rsp+360h] [rbp+2E0h]  </span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> ( (<span class="built_in">strlen</span>(a1) &amp; <span class="number">0xF</span>) != <span class="number">0</span> )  </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;Fail!\n&quot;</span>);  </span><br><span class="line">  __asm  </span><br><span class="line">  &#123;  </span><br><span class="line">    vxorps  xmm0, xmm0, xmm0  </span><br><span class="line">    vmovaps [rsp+<span class="number">390</span>h+var_F0], ymm0  </span><br><span class="line">    vmovups ymm0, cs:ymmword_14001D090  </span><br><span class="line">    vmovaps [rsp+<span class="number">390</span>h+var_B0], ymm0  </span><br><span class="line">  &#125;  </span><br><span class="line">  v28[<span class="number">1</span>] = v29;  </span><br><span class="line">  v34[<span class="number">0</span>] = <span class="number">0xE795A7603F90341Fu</span>i64;  </span><br><span class="line">  v30 = <span class="number">0xE795A7603F90341Fu</span>i64;  </span><br><span class="line">  v34[<span class="number">1</span>] = <span class="number">0xC65BF3E99CAA093Cu</span>i64;  </span><br><span class="line">  v31 = <span class="number">0xC65BF3E99CAA093Cu</span>i64;  </span><br><span class="line">  v34[<span class="number">2</span>] = <span class="number">0xCF59BCC699A060E9u</span>i64;  </span><br><span class="line">  v32 = <span class="number">0xCF59BCC699A060E9u</span>i64;  </span><br><span class="line">  v34[<span class="number">3</span>] = <span class="number">0xA727C0574231E1F6u</span>i64;  </span><br><span class="line">  v33 = <span class="number">0xA727C0574231E1F6u</span>i64;  </span><br><span class="line">  __asm  </span><br><span class="line">  &#123;  </span><br><span class="line">    vmovups ymm0, cs:ymmword_14001D090  </span><br><span class="line">    vmovaps [rsp+<span class="number">390</span>h+var_30], ymm0  </span><br><span class="line">  &#125;  </span><br><span class="line">  v27 = v36;  </span><br><span class="line">  v35 = v36;  </span><br><span class="line">  _RCX = v34;  </span><br><span class="line">  __asm &#123; vmovdqa ymm1, ymmword ptr [rcx] &#125;  </span><br><span class="line">  _RCX = &amp;v27;  </span><br><span class="line">  __asm  </span><br><span class="line">  &#123;  </span><br><span class="line">    vmovdqa ymm0, ymmword ptr [rcx]  </span><br><span class="line">    vmovdqa [rsp+<span class="number">390</span>h+var_250], ymm1  </span><br><span class="line">    vmovdqa [rsp+<span class="number">390</span>h+var_270], ymm0  </span><br><span class="line">    vmovdqa ymm0, [rsp+<span class="number">390</span>h+var_270]  </span><br><span class="line">    vpxor   ymm0, ymm0, [rsp+<span class="number">390</span>h+var_250]  </span><br><span class="line">    vmovdqa [rsp+<span class="number">390</span>h+var_290], ymm0  </span><br><span class="line">    vmovdqa ymm0, [rsp+<span class="number">390</span>h+var_290]  </span><br><span class="line">  &#125;  </span><br><span class="line">  _RCX = &amp;v27;  </span><br><span class="line">  __asm &#123; vmovdqa ymmword ptr [rcx], ymm0 &#125;  </span><br><span class="line">  *(_OWORD *)v28[<span class="number">0</span>].m256_f32 = *(_OWORD *)v27.m256_f32;  </span><br><span class="line">  __asm &#123; vzeroupper &#125;  </span><br><span class="line">  sub_1400054D0(v26, <span class="number">0</span>i64, <span class="number">256</span>i64);  </span><br><span class="line">  v15 = <span class="built_in">strlen</span>(a1);  </span><br><span class="line">  sub_140002410((<span class="type">unsigned</span> <span class="type">int</span>)v28, <span class="number">16</span>, (_DWORD)a1, (<span class="type">unsigned</span> <span class="type">int</span>)v26, v15);  </span><br><span class="line">  _RAX = v26;  </span><br><span class="line">  __asm  </span><br><span class="line">  &#123;  </span><br><span class="line">    vmovups ymm0, ymmword ptr [rax]  </span><br><span class="line">    vmovups ymm1, cs:enc  </span><br><span class="line">    vpxor   ymm0, ymm0, ymm1  </span><br><span class="line">    vptest  ymm0, ymm0  </span><br><span class="line">  &#125;  </span><br><span class="line">  <span class="keyword">if</span> ( _ZF )  </span><br><span class="line">  &#123;  </span><br><span class="line">    __asm &#123; vzeroupper &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;Success!&quot;</span>);  </span><br><span class="line">  &#125;  </span><br><span class="line">  <span class="keyword">else</span>  </span><br><span class="line">  &#123;  </span><br><span class="line">    __asm &#123; vzeroupper &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;Fail!&quot;</span>);  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>这个函数中定义了一些重要的常量数据，继续跟踪sub_140002410 函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_140002410</span><span class="params">(__int64 a1, <span class="type">unsigned</span> <span class="type">int</span> a2, __int64 a3, __int64 a4, <span class="type">unsigned</span> <span class="type">int</span> a5)</span>  </span><br><span class="line">&#123;  </span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+30h] [rbp-50h] AES  </span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+34h] [rbp-4Ch]  </span></span><br><span class="line">  <span class="type">char</span> *v8; <span class="comment">// [rsp+38h] [rbp-48h]  </span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+40h] [rbp-40h]  </span></span><br><span class="line">  <span class="type">char</span> v15[<span class="number">16</span>]; <span class="comment">// [rsp+70h] [rbp-10h] BYREF  </span></span><br><span class="line">  <span class="type">char</span> v16[<span class="number">16</span>]; <span class="comment">// [rsp+80h] [rbp+0h] BYREF  </span></span><br><span class="line">  <span class="type">char</span> v17[<span class="number">20</span>]; <span class="comment">// [rsp+90h] [rbp+10h] BYREF  </span></span><br><span class="line">  <span class="type">char</span> v18[<span class="number">356</span>]; <span class="comment">// [rsp+A4h] [rbp+24h] BYREF  </span></span><br><span class="line">  </span><br><span class="line">  v9 = a4;  </span><br><span class="line">  v8 = v18;  </span><br><span class="line">  sub_1400054D0(v17, <span class="number">0</span>i64, <span class="number">16</span>i64);  </span><br><span class="line">  sub_1400054D0(v16, <span class="number">0</span>i64, <span class="number">16</span>i64);  </span><br><span class="line">  sub_1400054D0(v15, <span class="number">0</span>i64, <span class="number">16</span>i64);  </span><br><span class="line">  <span class="keyword">if</span> ( a1 &amp;&amp; a3 &amp;&amp; a4 )  </span><br><span class="line">  &#123;  </span><br><span class="line">    <span class="keyword">if</span> ( a2 &lt;= <span class="number">0x10</span> )  </span><br><span class="line">    &#123;  </span><br><span class="line">      <span class="keyword">if</span> ( (a5 &amp; <span class="number">0xF</span>) != <span class="number">0</span> )  </span><br><span class="line">      &#123;  </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;inLen is invalid.\n&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">int</span>)<span class="number">-1</span>;  </span><br><span class="line">      &#125;  </span><br><span class="line">      <span class="keyword">else</span>  </span><br><span class="line">      &#123;  </span><br><span class="line">        sub_140004E00(v16, a1, a2);  </span><br><span class="line">        sub_140001A70(v16, <span class="number">16</span>i64, v18);  </span><br><span class="line">        <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; a5; i += <span class="number">16</span> )  </span><br><span class="line">        &#123;  </span><br><span class="line">          sub_140001930(v15, a3);  </span><br><span class="line">          sub_140001E30(v15, v18);  </span><br><span class="line">          <span class="keyword">for</span> ( j = <span class="number">1</span>; j &lt; <span class="number">10</span>; ++j )  </span><br><span class="line">          &#123;  </span><br><span class="line">            v8 += <span class="number">16</span>;  </span><br><span class="line">            sub_140001F40(v15);  </span><br><span class="line">            sub_140001FE0(v15);  </span><br><span class="line">            sub_140002240(v15);  </span><br><span class="line">            sub_140001E30(v15, v8);  </span><br><span class="line">          &#125;  </span><br><span class="line">          sub_140001F40(v15);  </span><br><span class="line">          sub_140001FE0(v15);  </span><br><span class="line">          sub_140001E30(v15, v8 + <span class="number">16</span>);  </span><br><span class="line">          sub_1400019D0(v15, v9);  </span><br><span class="line">          v9 += <span class="number">16</span>i64;  </span><br><span class="line">          a3 += <span class="number">16</span>i64;  </span><br><span class="line">          v8 = v18;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">      &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">else</span>  </span><br><span class="line">    &#123;  </span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;keyLen must be 16.\n&quot;</span>);  </span><br><span class="line">      <span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">int</span>)<span class="number">-1</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  &#125;  </span><br><span class="line">  <span class="keyword">else</span>  </span><br><span class="line">  &#123;  </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;param err.\n&quot;</span>);  </span><br><span class="line">    <span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">int</span>)<span class="number">-1</span>;  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>经分析可知这个函数执行 AES-128 加密算法</p>
<p>在内存中定位ymmword_14001D090（初始化向量），ymmword_140028E60（最终校验值）两块内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.rdata:000000014001D090 48 51 FC 5C 0F CA F0 A4     ymmword_14001D090 ymmword 4851FC5C0FCAF0A4684FFDF39B9F3FE7E960A099C6BC59CFF6E1314257C027A7  </span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.data:0000000140028E60 00 00 00 00 00 00 00 00     enc             ymmword 0000000000000000000000000000000000000000000000000000000000000000  </span><br></pre></td></tr></table></figure>
<p>发现ymmword_140028E60（我重命名为了enc）全为0，怀疑是后续处理过程中被修改了，Ctrl+X查看调用，定位到如下的函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">unsigned __int64 __fastcall TlsCallback_0(__int64 a1, int a2)  </span><br><span class="line">&#123;  </span><br><span class="line">  unsigned __int64 result; // rax  </span><br><span class="line">  </span><br><span class="line">  if ( a2 == 1 )  </span><br><span class="line">  &#123;  </span><br><span class="line">    *(_QWORD *)ymmword_140028E60.m256_f32 = 0x7A90C58C47D4507Fi64;  </span><br><span class="line">    *(_QWORD *)&amp;ymmword_140028E60.m256_f32[2] = 0x9E9055008CD0D563ui64;  </span><br><span class="line">    *(_QWORD *)&amp;ymmword_140028E60.m256_f32[4] = 0xD1ECFF77563CB8B3ui64;  </span><br><span class="line">    result = 0x8EBDCA36448856FFui64;  </span><br><span class="line">    *(_QWORD *)&amp;ymmword_140028E60.m256_f32[6] = 0x8EBDCA36448856FFui64;  </span><br><span class="line">  &#125;  </span><br><span class="line">  return result;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>由此便可写AES脚本解密：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii  </span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES  </span><br><span class="line">key_component1 = binascii.unhexlify(<span class="string">&quot;4851FC5C0FCAF0A4684FFDF39B9F3FE7E960A099C6BC59CFF6E1314257C027A7&quot;</span>)  </span><br><span class="line">key_component2 = <span class="string">b&quot;&quot;</span>  </span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> [  </span><br><span class="line">    <span class="number">0xE795A7603F90341F</span>,   </span><br><span class="line">    <span class="number">0xC65BF3E99CAA093C</span>,  </span><br><span class="line">    <span class="number">0xCF59BCC699A060E9</span>,  </span><br><span class="line">    <span class="number">0xA727C0574231E1F6</span>  </span><br><span class="line">]:  </span><br><span class="line">    key_component2 += value.to_bytes(<span class="number">8</span>, <span class="string">&#x27;little&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">aes_key = <span class="built_in">bytes</span>(a ^ b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(key_component1[:<span class="number">16</span>], key_component2[:<span class="number">16</span>]))  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;计算出的AES密钥: <span class="subst">&#123;aes_key.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">ciphertext = binascii.unhexlify(  </span><br><span class="line">    <span class="string">&quot;7F50D4478CC5907A&quot;</span>  </span><br><span class="line">    <span class="string">&quot;63D5D08C0055909E&quot;</span>  </span><br><span class="line">    <span class="string">&quot;B3B83C5677FFECD1&quot;</span>  </span><br><span class="line">    <span class="string">&quot;FF56884436CABD8E&quot;</span>  </span><br><span class="line">)  </span><br><span class="line">cipher = AES.new(aes_key, AES.MODE_ECB)  </span><br><span class="line">plaintext = cipher.decrypt(ciphertext)  </span><br><span class="line"><span class="keyword">try</span>:  </span><br><span class="line">    flag = plaintext.decode(<span class="string">&#x27;utf-8&#x27;</span>).strip()  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;解密的Flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)  </span><br><span class="line"><span class="keyword">except</span> UnicodeDecodeError:  </span><br><span class="line">    hex_flag = plaintext.<span class="built_in">hex</span>()  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;解密结果（16进制）: <span class="subst">&#123;hex_flag&#125;</span>&quot;</span>)  </span><br><span class="line">    printable = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(b) <span class="keyword">if</span> <span class="number">32</span> &lt;= b &lt;= <span class="number">126</span> <span class="keyword">else</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">for</span> b <span class="keyword">in</span> plaintext)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;解密结果（ASCII）: <span class="subst">&#123;printable&#125;</span>&quot;</span>)  </span><br><span class="line"><span class="comment"># 得到真FLAG：flag&#123;Y0u_get_tloe-success-f1ag!&#125;  </span></span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://hanafudastore.github.io">hanafuda_store</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://hanafudastore.github.io/2025/05/26/AES/">https://hanafudastore.github.io/2025/05/26/AES/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://hanafudastore.github.io" target="_blank">hanafuda_store's Blog</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="https://github.com/HanafudaStore/HanafudaStore.github.io/blob/main/img/b_52dc589762a01ba008b258bcf66823d6.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/05/26/RC4/" title="RC4算法及例题总结"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">RC4算法及例题总结</div></div><div class="info-2"><div class="info-item-1">  算法详解RC4是一种流加密算法，其工作原理可以分为两个主要部分：密钥调度算法KSA和伪随机生成算法PRGA。  KSA密钥调度算法：    初始化一个256字节的数组S，S[i] &#x3D; i。    根据密钥对S进行混排。通过循环交换S数组中的元素，确保密钥影响S的内容。  PRGA伪随机生成算法：    使用KSA生成的S数组，通过循环更新和交换元素生成伪随机字节。    生成的字节与明文进行异或运算，得到密文。   RC4的加密和解密过程相同，因为它是基于与伪随机流的异或运算。 实战识别在逆向分析实战中判断RC4算法的可从其会初始化一个256字节的数组 和将一个key填充到数组中以及加密函数大概率有两个参数,一个是key 一个是keylen 代码实现下面是RC4算法加 &#x2F;解密过程的C语言代码实现 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465#include &l...</div></div></div></a><a class="pagination-related" href="/2025/04/23/%E5%88%9D%E8%AF%86%E5%8F%8D%E8%B0%83%E8%AF%95/" title="初识反调试"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">初识反调试</div></div><div class="info-2"><div class="info-item-1">  IsDebuggerPresent()函数包含在debugapi.h头文件中，函数原型： 1BOOL IsDebuggerPresent();   //未在调试器中运行时返回值为零，否则为非零值   该函数允许程序确定是否正在由用户模式调试器（如 OllyDbg 或 x64dbg）调试它，以便可以修改其行为。通常，该函数只检查进程环境块 （PEB） 的 BeingDebugged 标志。 Assembly： 1234567    call IsDebuggerPresent          test al, al      jne  being_debugged      ...  being_debugged:      push 1      call ExitProcess   C&#x2F;C++: 12if (IsDebuggerPresent())      ExitProcess(-1);   CheckRemoteDebuggerPresent()函数包含在kernel32中的CheckRemoteDebuggerPresent()检查调试器（在同一台计算机...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://github.com/HanafudaStore/HanafudaStore.github.io/blob/main/img/b_52dc589762a01ba008b258bcf66823d6.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">hanafuda_store</div><div class="author-info-description">调和 变革</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%97%E6%B3%95%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.</span> <span class="toc-text">算法详解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.</span> <span class="toc-text">代码实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%8B%E9%A2%98"><span class="toc-number">3.</span> <span class="toc-text">例题</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/03/WindowsAPI%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="WindowsAPI学习笔记">WindowsAPI学习笔记</a><time datetime="2025-09-02T22:00:00.000Z" title="发表于 2025-09-03 06:00:00">2025-09-03</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/02/C++%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="C++学习笔记（更新中）">C++学习笔记（更新中）</a><time datetime="2025-09-01T22:00:00.000Z" title="发表于 2025-09-02 06:00:00">2025-09-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/14/ChaCha20/" title="ChaCha20算法总结">ChaCha20算法总结</a><time datetime="2025-08-13T22:00:00.000Z" title="发表于 2025-08-14 06:00:00">2025-08-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/14/Salsa20/" title="RC4算法及例题总结">RC4算法及例题总结</a><time datetime="2025-08-13T22:00:00.000Z" title="发表于 2025-08-14 06:00:00">2025-08-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/11/%E5%8D%9A%E5%AE%A2%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F/" title="Hexo+Butterfly博客的评论系统实现（Giscus）">Hexo+Butterfly博客的评论系统实现（Giscus）</a><time datetime="2025-07-10T22:00:00.000Z" title="发表于 2025-07-11 06:00:00">2025-07-11</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2019 - 2025 By hanafuda_store</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.1</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>